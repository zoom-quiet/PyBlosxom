<?xml version="1.0" encoding="utf-8"?>

<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh">
<title type="text">Z<sub>en</sub>o<sub>f</sub>o<sub>pen</sub>M<sup>ind</sup>. Q<sub>uickly</sub>u<sub>tility</sub>i<sub>nternet</sub>e<sub>asy</sub>t<sup>echnic</sup></title>
<subtitle type="html"><![CDATA[
Zoom.Quiet's PyBlosxom blogging
]]></subtitle>
<id>/pyblosxom/2010/index.atom</id>
<link rel="alternate" type="text/html" href="/pyblosxom" />
<link rel="self" type="application/atom+xml" href="/pyblosxom/2010/index.atom" />


<author>
<name>Zoom.Quiet</name>
<uri>/pyblosxom/2010/index.atom</uri>
<email>zoomquiet+blog [AT] gmail.com</email>
</author>
<rights>Copyright 2001-2012 Zoom.Quiet</rights>
<generator uri="http://pyblosxom.sourceforge.net/" version="1.5.2">
PyBlosxom http://pyblosxom.sourceforge.net/ 1.5.2
</generator>

<updated>2010-10-08T17:00:00Z</updated>
<!-- icon?  logo?  -->

<entry>
<title type="html">M$ DLL Hell</title>
<category term="/easy/music" />
<id>/pyblosxom/2010/10/09/ms-dll-hell-2010-10-09-01-00</id>
<updated>2010-10-08T17:00:00Z</updated>
<published>2010-10-08T17:00:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/easy/music/ms-dll-hell-2010-10-09-01-00.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopSlVTQ0FSQ&#x27; id=&#x27;toptopSlVTQ0FSQ&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;M$ DLL Hell&lt;&#x2F;h1&gt;
&lt;h2&gt;~ KUSO Windows编程革命简史 之歌&lt;&#x2F;h2&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;ul&gt;
&lt;li&gt;Windows编程革命简史 | 酷壳 - CoolShell.cn
 &lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;coolshell.cn&#x2F;articles&#x2F;3008.html&quot;&gt;http:&#x2F;&#x2F;coolshell.cn&#x2F;articles&#x2F;3008.html&lt;&#x2F;a&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;忒给力了！ 想起: 新同事 | zonble’s promptbook
 &lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;zonble.net&#x2F;archives&#x2F;2007_05&#x2F;937.php&quot;&gt;http:&#x2F;&#x2F;zonble.net&#x2F;archives&#x2F;2007_05&#x2F;937.php&lt;&#x2F;a&gt;
 &lt;p&gt;&lt;&#x2F;p&gt;
忍不住给个歌词吧,谁人有给力的曲,我们配首 &lt;b&gt;微软革命之歌&lt;&#x2F;b&gt; :
 &lt;p&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  text&quot;&gt;

M$ DLL Hell

起初,我说起初
那儿只有 Windows API 和 DLL Hell
为了消灭 DLL Hell
然后,DDE 出现了

但是,他们说DDE 有重大缺陷：
丫不是俺写的！
于是 OLE 出现了
除了名字和 DDE 不同
其它其实真的一样的哈！

后来,他们信了 C++
为嘛?!你懂的,你真得懂的!
于是 OLE 通过 MFC 进化成 COM
为嘛?!你懂的,你真得懂的!

但是,他们说 MFC 有重大缺陷：
丫不是俺写的！
于是 ATL 出现了
除了名字和 MFC 不同
其它其实真的一样的哈！

然后 COM 变身成 ActiveX
为嘛?!你懂的,你真得懂的!
于是 DLL Hell 再次被消灭鸟
为嘛?!你懂的,你真得懂的!

同时,他们说 JAVA 有重大缺陷：
丫不是俺写的！
于是 ActiveJ 出现了
除了名字和 JAVA 不同
其它其实真的一样的哈！

然后 COM 变身成 MTS
为嘛?!你懂的,你真得懂的!
于是 DLL Hell 再次被消灭鸟
为嘛?!你懂的,你真得懂的!

现在,他们说 Internet 有重大缺陷：
你懂的,你真得懂的!
于是 .NET 出现了
除了名字和 Internet 不同
其它其实真的一样的哈！

然后 C++ 变身成 C#
为嘛?!你懂的,你真得懂的!
于是 DLL Hell 再次被消灭鸟
为嘛?!你懂的,你真得懂的!

你懂的!
你真得要懂的!
为嘛?! DLL Hell 总在被消灭?!
为嘛?!
因为 M$ 在革命!
&lt;&#x2F;pre&gt;
 &lt;p&gt;&lt;&#x2F;p&gt;
&lt;hr class=&quot;light&quot; &#x2F;&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;t2t渲染:: 2010-10-09 02:21:39
&lt;&#x2F;li&gt;
&lt;li&gt;动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;easy&#x2F;music&#x2F;ms-dll-hell-2010-10-09-01-00.t2t --&gt;
</content>
</entry>

<entry>
<title type="html">rst2s5</title>
<category term="/utility/py4str/StructuredText" />
<id>/pyblosxom/2010/09/18/rst2s5-usage-2010-09-18-23-23</id>
<updated>2010-09-18T15:23:00Z</updated>
<published>2010-09-18T15:23:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/utility/py4str/StructuredText/rst2s5-usage-2010-09-18-23-23.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopT0paWElNV&#x27; id=&#x27;toptopT0paWElNV&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;rst2s5&lt;&#x2F;h1&gt;
&lt;h2&gt;~ 好用的S5生成宏&lt;&#x2F;h2&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
  &lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#toc1R0VYQ0JaN&quot;&gt;缘起&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc2R0lYQ0IyR&quot;&gt;运用&lt;&#x2F;a&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#toc3R0lYRENMU&quot;&gt;2.1. 初步&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc4R0lYREVMU&quot;&gt;2.2. rst&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc5R0lYREdMU&quot;&gt;2.3. 定制&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc6R01YQ0JaV&quot;&gt;时间帐单&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ol&gt;

&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;a id=&quot;toc1R0VYQ0JaN&quot; name=&quot;toc1R0VYQ0JaN&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopT0paWElNV&#x27;&gt; 1. 缘起 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
最近讲演频繁:
&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;100820: &lt;a href=&quot;http:&#x2F;&#x2F;wiki.woodpecker.org.cn&#x2F;moin&#x2F;IntroPy&quot;&gt;IntroPy - Woodpecker Wiki for CPUG&lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;100826: &lt;a href=&quot;http:&#x2F;&#x2F;wiki.woodpecker.org.cn&#x2F;moin&#x2F;TDD4Py&quot;&gt;TDD4Py - Woodpecker Wiki for CPUG&lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;100918: &lt;a href=&quot;file:&#x2F;&#x2F;&#x2F;home&#x2F;zoomq&#x2F;zdata&#x2F;zScrapBook&#x2F;ZqFLOSS&#x2F;data&#x2F;20100817125828&#x2F;index.html&quot;&gt;Software Freedom Day 2010 - SZLUG&lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;...
&lt;p&gt;&lt;&#x2F;p&gt;
俺在 &lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;meyerweb.com&#x2F;eric&#x2F;tools&#x2F;s5&#x2F;&quot;&gt;S5: A Simple Standards-Based Slide Show System&lt;&#x2F;a&gt;&lt;&#x2F;b&gt; 中使用高桥流，幻灯页码轻易超过100! 即使有 Leo 帮助也感觉吃不住，
主要原因是直接写 HTML 太多标签干扰思維了...
&lt;p&gt;&lt;&#x2F;p&gt;
其实早就知道有 rst-&amp;gt;s5 的工具:
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;inet6.blogspot.com&#x2F;2007&#x2F;03&#x2F;rsts5.html&quot;&gt;結構文本(rst)轉網頁投影片(s5)&lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;docutils.sourceforge.net&#x2F;docs&#x2F;user&#x2F;slide-shows.html&quot;&gt;Easy Slide Shows With reST &amp;amp; S5&lt;&#x2F;a&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
但是因为自个儿的s5 样式进行了深入定制，不知道是否容易迁移;
&lt;p&gt;&lt;&#x2F;p&gt;
可是实在幻灯稿多了受不住，就迁移了...
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc2R0lYQ0IyR&quot; name=&quot;toc2R0lYQ0IyR&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopT0paWElNV&#x27;&gt; 2. 运用 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
文档的确不多,中文的就找到上述 Inet6 兄的，但是和谐后，也无法方便的直接咨询
&lt;&#x2F;p&gt;
&lt;p&gt;
仔细看了哈文档，发现的确不复杂;
&lt;&#x2F;p&gt;
&lt;p&gt;
之于俺，只是要引用原先的样式，只要:
&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  shell; highlight: [3,5]&quot;&gt;

#   先随便生成个默认工程
rst2s5.py --theme &amp;lt;base-theme&amp;gt; &amp;lt;doc&amp;gt;.txt &amp;lt;doc&amp;gt;.html
#   再复制原先样式过来
ui&#x2F;&amp;lt;base-theme&amp;gt; to ui&#x2F;&amp;lt;new-theme&amp;gt;.
#   然后聲明使用新样式就好:
rst2s5.py --theme-url ui&#x2F;&amp;lt;new-theme&amp;gt; &amp;lt;doc&amp;gt;.txt &amp;lt;doc&amp;gt;.html

#   俺在对应目录中的实际命令就是:
python rst2s5-Pygments.py  --current-slide --theme-url=ui&#x2F;freedom index.rst index.html
&lt;&#x2F;pre&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;code&gt;--current-slide&lt;&#x2F;code&gt; 是要求生成页码的开关参数
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;code&gt;rst2s5 --help&lt;&#x2F;code&gt; 居然看到有几十种参数,才发现
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;docutils.sourceforge.net&#x2F;docs&#x2F;user&#x2F;tools.html&quot;&gt;Docutils Front-End Tools&lt;&#x2F;a&gt;  实在是个丰富的工具集!
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;matt-good.net&#x2F;files&#x2F;software-dev-with-trac&#x2F;rst2s5&quot;&gt;rst2s5-Pygments.py&lt;&#x2F;a&gt; 是定制过的支持 Pygments 语法颜色的 rst2s5 转换脚本!
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;

&lt;p&gt;
最后发布时的 s5演示目录分布是:
&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  text&quot;&gt;

http:&#x2F;&#x2F;zoomquiet.org&#x2F;res&#x2F;s5&#x2F;100918-MyTools&#x2F;rst2s5&#x2F;
+-- i                   资源目录(图片什么的...)
|-- index.html          S5
|-- index.rst           rst撰写原文稿
|-- rst2s5-Pygments.py  定制支持 Pygments 语法颜色渲染的s5生成脚本
|-- s5defs.txt          rst2s5引用的 s5 配置文件
`-- ui                  样式入口
    +-- default         默认样式
    `-- freedom         定制样式 
&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;a id=&quot;toc3R0lYRENMU&quot; name=&quot;toc3R0lYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopT0paWElNV&#x27;&gt; 2.1. 初步 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;
和S5 幻灯组织是完全对等的撰写:
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;HTML 首页:
&lt;pre class=&quot;brush:  html ; highlight: [1]&quot;&gt;

&amp;lt;div class=&quot;slide&quot; id=&quot;slide0&quot;&amp;gt;
Blalala
&amp;lt;&#x2F;div&amp;gt;
&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;rST首页:
&lt;pre class=&quot;brush:  text ; highlight: [2]&quot;&gt;

==================================================================
我的工具箱
==================================================================
&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;HTML幻灯页:
&lt;pre class=&quot;brush:  html ; highlight: [1,2,4]&quot;&gt;

&amp;lt;div class=&quot;slide&quot;&amp;gt;
&amp;lt;h1&amp;gt;标题&amp;lt;&#x2F;h1&amp;gt;
内容
    &amp;lt;div class=&quot;handout&quot;&amp;gt;
    隐藏提示
    &amp;lt;&#x2F;div&amp;gt;
&amp;lt;&#x2F;div&amp;gt;
&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;rST幻灯页:
&lt;pre class=&quot;brush:  html ; highlight: [2,4]&quot;&gt;

标题
=========

.. container:: handout

   隐藏提示

内容
&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;唯一注意:&lt;&#x2F;dt&gt;&lt;dd&gt;
 &lt;ul&gt;
 &lt;li&gt;是要在文件头部引入 &lt;a href=&quot;http:&#x2F;&#x2F;docutils.sourceforge.net&#x2F;docutils&#x2F;parsers&#x2F;rst&#x2F;include&#x2F;s5defs.txt&quot;&gt;s5defs.txt&lt;&#x2F;a&gt; 专用配置文本:
&lt;pre class=&quot;brush:  text&quot;&gt;

.. include:: &amp;lt;s5defs.txt&amp;gt;
&lt;&#x2F;pre&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;参考: &lt;a href=&quot;http:&#x2F;&#x2F;docutils.sourceforge.net&#x2F;docs&#x2F;ref&#x2F;rst&#x2F;substitutions.html&quot;&gt;reStructuredText Standard Substitution Definition Sets&lt;&#x2F;a&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc4R0lYREVMU&quot; name=&quot;toc4R0lYREVMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopT0paWElNV&#x27;&gt; 2.2. rst &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;
html-&amp;gt;rst 的撰写只有更加 &lt;a href=&quot;http:&#x2F;&#x2F;wiki.woodpecker.org.cn&#x2F;moin&#x2F;WyTiWyG&quot;&gt;WYTIWYG&lt;&#x2F;a&gt; 很容易习惯;
&lt;&#x2F;p&gt;
&lt;p&gt;
参考: &lt;a href=&quot;reStructuredText&quot;&gt;http:&#x2F;&#x2F;docutils.sourceforge.net&#x2F;docs&#x2F;user&#x2F;rst&#x2F;quickref.html Quick&lt;&#x2F;a&gt;
&lt;&#x2F;p&gt;
&lt;p&gt;
主要得习惯的只有:
&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;标题和 MoinMoin 语法不同使用 &lt;code&gt;==================&lt;&#x2F;code&gt;独立的标题引用行来聲明第几层的标题
 &lt;ul&gt;
 &lt;li&gt;建议顺序是:&lt;code&gt;= - ` : &#x27; &quot; ~ ^ _ * + # &amp;lt; &amp;gt;&lt;&#x2F;code&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;一般就用到前4个:
&lt;pre class=&quot;brush:  text&quot;&gt;


大标题
======
小标题
------
次标题
&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;
小节标
&quot;&quot;&quot;&quot;&quot;&quot;
&lt;&#x2F;pre&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;列表项更加简单可以使用 &lt;code&gt;+&lt;&#x2F;code&gt; 以及 &lt;code&gt;-&lt;&#x2F;code&gt; 相比&lt;code&gt;*&lt;&#x2F;code&gt; 要少按个键 ;-)
&lt;&#x2F;li&gt;
&lt;li&gt;链接更加灵活了:
 &lt;ul&gt;
 &lt;li&gt;就地链接: &lt;code&gt;是也乎,是也乎`显示文字 &amp;lt;http:&#x2F;&#x2F;foo.org&amp;gt;`__ 是也乎&lt;&#x2F;code&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;匿名链接: 
&lt;pre class=&quot;brush:  text&quot;&gt;

是也乎,是也乎`显示文字`__ 是也乎

__  http:&#x2F;&#x2F;foo.org
&lt;&#x2F;pre&gt;
    &lt;ul&gt;
    &lt;li&gt;和行内链接聲明最近的独立URL 定义进行自动匹配
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;全局链接:
&lt;pre class=&quot;brush:  text ; highlight: [1,5]&quot;&gt;

.. _Zoom.Quiet:
    http:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;openbookproject&#x2F;wiki&#x2F;ZoomQuiet

...
是也乎,是也乎`Zoom.Quiet`_ 是也乎

&lt;&#x2F;pre&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;就地图片:
&lt;pre class=&quot;brush:  text ; highlight: [2,3,5]&quot;&gt;

.. image:: pix&#x2F;Takahashi-method.jpg
    :align: center
    :scale: 150 %
    :alt: 高橋流
    :target: http:&#x2F;&#x2F;blog.derjohng.com&#x2F;2006&#x2F;04&#x2F;12&#x2F;takahashi-method-%E7%B0%A1%E5%A0%B1&#x2F;
&lt;&#x2F;pre&gt;
    &lt;ul&gt;
    &lt;li&gt;这个 target 就是链接! 文档中没有例子,找了半天...
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;全局图片:
&lt;pre class=&quot;brush:  text ; highlight: [2]&quot;&gt;

.. |Takahashi| image:: pix&#x2F;Takahashi-method.jpg
    :align: top
    :scale: 150 %
    :alt: 高橋流
    :target: http:&#x2F;&#x2F;blog.derjohng.com&#x2F;2006&#x2F;04&#x2F;12&#x2F;takahashi-method-%E7%B0%A1%E5%A0%B1&#x2F;

...

任意文字中 |Takahashi| 嵌入图片...
&lt;&#x2F;pre&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;code&gt;align&lt;&#x2F;code&gt; 这时,就是图片和文字流的行内相对位置,而不是图片在整个页面的排版,所以,只能有&quot;top&quot;, &quot;middle&quot;, &quot;bottom&quot;
    &lt;&#x2F;li&gt;
    &lt;li&gt;其实不用专门记忆,每次渲染时, rst2s5 会进行检查,比如说:
&lt;pre class=&quot;brush:  shell ; highlight: [3,4]&quot;&gt;

$ python rst2s5-Pygments.py  --current-slide --theme-url=ui&#x2F;freedom index.rst index.html
index.rst:34: (ERROR&#x2F;3) Error in &quot;image&quot; directive: 
&quot;center&quot; is not a valid value for the &quot;align&quot; option within a substitution definition.  
Valid values for &quot;align&quot; are: &quot;top&quot;, &quot;middle&quot;, &quot;bottom&quot;.
index.rst:34: (WARNING&#x2F;2) Substitution definition &quot;S5icon&quot; empty or invalid.

.. |S5icon| image:: pix&#x2F;S5icon.GIF
    :align: center
    :scale: 100 %
    :target: http:&#x2F;&#x2F;www.meyerweb.com&#x2F;eric&#x2F;tools&#x2F;s5&#x2F;
index.rst:1284: (ERROR&#x2F;3) Undefined substitution referenced: &quot;S5icon&quot;.
&lt;&#x2F;pre&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;p&gt;
嗯嗯嗯, 使用 rst 进行 s5 撰写,完全是脚本组织的感觉了...连输出时的交互 error 通告都是 Python 味的..
&lt;&#x2F;p&gt;
&lt;a id=&quot;toc5R0lYREdMU&quot; name=&quot;toc5R0lYREdMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopT0paWElNV&#x27;&gt; 2.3. 定制 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;
比较囧是只有俺习惯并坚持的样式很搞:
&lt;&#x2F;p&gt;
&lt;dl&gt;
&lt;dt&gt;默认的样式排版:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;dl&gt;
    &lt;dt&gt;&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;rst2st-theme-default.png&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;&#x2F;dd&gt;
    &lt;&#x2F;dl&gt;
    &lt;ul&gt;
    &lt;li&gt;和 s5 的默认样式100% 一致!
    &lt;p&gt;&lt;&#x2F;p&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;
&lt;dt&gt;定制的&lt;code&gt;Freedome&lt;&#x2F;code&gt;样式:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;dl&gt;
    &lt;dt&gt;&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;ZQshutter_100920-151219_html.png&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;&lt;&#x2F;dt&gt;&lt;dd&gt;
    主要的设计:
     &lt;ul&gt;
     &lt;li&gt;A: 表格3栏格式的作者和版权聲明
&lt;pre class=&quot;brush:  html ; highlight: [6]&quot;&gt;

&amp;lt;div id=&quot;footer&quot;&amp;gt;
&amp;lt;table&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;
&amp;lt;a target=&quot;_blank&quot;  href=&quot;http:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;openbookproject&#x2F;wiki&#x2F;ZoomQuiet&quot;&amp;gt;
Zoom.Quiet&amp;lt;&#x2F;a&amp;gt;&amp;lt;br&#x2F;&amp;gt;v10.8.17
&amp;lt;&#x2F;td&amp;gt;
&amp;lt;td rowspan=&quot;2&quot;&amp;gt;
&amp;lt;a  target=&quot;_blank&quot; style=&quot;background-color:;&quot; href=&quot;http:&#x2F;&#x2F;creativecommons.org&#x2F;licenses&#x2F;by-nc-nd&#x2F;3.0&#x2F;deed.zh&quot;&amp;gt;
&amp;lt;img src=&quot;icon&#x2F;cc-byncnd-88x31.png&quot;&#x2F;&amp;gt;
&amp;lt;&#x2F;a&amp;gt;Recommend &amp;lt;a  target=&quot;_blank&quot;
href=&quot;http:&#x2F;&#x2F;www.mozilla.org.cn&quot;&amp;gt;FireFox&amp;lt;&#x2F;a&amp;gt; for the best experience!
&amp;lt;&#x2F;td&amp;gt;&amp;lt;&#x2F;tr&amp;gt;
&amp;lt;&#x2F;table&amp;gt;
    &amp;lt;div id=&quot;controls&quot;&amp;gt;&amp;lt;&#x2F;div&amp;gt;
&amp;lt;&#x2F;div&amp;gt;
&lt;&#x2F;pre&gt;
     &lt;&#x2F;li&gt;
     &lt;li&gt;B: 页码&#x2F;页数 提示
     &lt;&#x2F;li&gt;
     &lt;li&gt;C: 当页内容提示
&lt;pre class=&quot;brush:  html ; highlight: [4]&quot;&gt;

&amp;lt;div class=&quot;slide&quot;&amp;gt;
&amp;lt;h1&amp;gt;
标题
&amp;lt;div id=&quot;sup&quot;&amp;gt;
    mov-&amp;gt;时间-&amp;gt;效能工具
&amp;lt;&#x2F;div&amp;gt;
&amp;lt;&#x2F;h1&amp;gt;
...
&lt;&#x2F;pre&gt;
     &lt;p&gt;&lt;&#x2F;p&gt;
     &lt;&#x2F;li&gt;
     &lt;&#x2F;ul&gt;
    &lt;&#x2F;dd&gt;
    &lt;&#x2F;dl&gt;
&lt;&#x2F;dd&gt;
&lt;dt&gt;对应的rst2s5 效果:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;dl&gt;
    &lt;dt&gt;&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;ZQshutter_100920-151709_rst2s4.png&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;p&gt;&lt;&#x2F;p&gt;
    对应的设计:
     &lt;ul&gt;
     &lt;li&gt;A: 表格的作者和版权聲明
&lt;pre class=&quot;brush:  text ; highlight: [1,2]&quot;&gt;

.. footer:: 
   .. class:: borderless

   =============  ====================================
   `Zoom.Quiet`_  |cc-byncsa15|
   -------------  ------------------------------------
   v10.09.16      推荐用 `FireFox`_ 获得最佳游览效果
   =============  ====================================
&lt;&#x2F;pre&gt;
     &lt;&#x2F;li&gt;
     &lt;li&gt;B: 页码&#x2F;页数 提示
     &lt;&#x2F;li&gt;
     &lt;li&gt;C: 当页内容提示
&lt;pre class=&quot;brush:  text ; highlight: [4]&quot;&gt;

标题
=========

.. container:: handout

   俺-&amp;gt;工具-&amp;gt;持续完善 |zqeye|

...
&lt;&#x2F;pre&gt;
        &lt;ul&gt;
        &lt;li&gt;嗯嗯嗯,当然的得配合CSS:
        &lt;&#x2F;li&gt;
        &lt;li&gt;注释掉默认样式&lt;code&gt;ui&#x2F;&amp;lt;theme&amp;gt;&#x2F;s5-core.css&lt;&#x2F;code&gt; 中的
&lt;pre class=&quot;brush:  css&quot;&gt;

.handout {display: none;}
&lt;&#x2F;pre&gt;
        &lt;&#x2F;li&gt;
        &lt;li&gt;在专用CSS&lt;code&gt;ui&#x2F;&amp;lt;theme&amp;gt;&#x2F;takahashi.css&lt;&#x2F;code&gt;中定制
&lt;pre class=&quot;brush:  css&quot;&gt;

div.handout{
    float: right;
    top:0;
    margin-top: -85px;
    margin-right: -30px;
    font-size: 16px; font-style : italic ;
    color: #385775;
}
div.handout a{
    color: #385775;
}

div.handout a:hover{
    color: orange;
    font-style : bold ;
}

&lt;&#x2F;pre&gt;
        &lt;&#x2F;li&gt;
        &lt;li&gt;还得在默认的样式调配文件&lt;code&gt;ui&#x2F;&amp;lt;theme&amp;gt;&#x2F;slides.css&lt;&#x2F;code&gt;中引入自个儿定制的:
&lt;pre class=&quot;brush:  css ; highlight: [4,5]&quot;&gt;

@import url(s5-core.css); &#x2F;* required to make the slide show run at all *&#x2F;
@import url(framing.css); &#x2F;* sets basic placement and size of slide components *&#x2F;
@import url(pretty.css);  &#x2F;* stuff that makes the slides look better than blah *&#x2F;
@import url(takahashi.css);  &#x2F;* stuff that makes the takahashi style slides *&#x2F;
@import url(rst2s5.css);  &#x2F;* stuff that support slides gen. by rst2s5 *&#x2F;
&lt;&#x2F;pre&gt;
        &lt;&#x2F;li&gt;
        &lt;&#x2F;ul&gt;
     &lt;&#x2F;li&gt;
     &lt;li&gt;D: 专用高桥流样式, 在s5专用子聲明文件:&lt;a href=&quot;http:&#x2F;&#x2F;docutils.sourceforge.net&#x2F;docutils&#x2F;parsers&#x2F;rst&#x2F;include&#x2F;s5defs.txt&quot;&gt;s5defs.txt&lt;&#x2F;a&gt;  中追加俺习惯的CSS类名:
&lt;pre class=&quot;brush:  text ; highlight: [1,8,9]&quot;&gt;

.. Text Sizes
   ==========

.. role:: huge
.. role:: big
.. role:: small
.. role:: tiny
.. role:: takahashi0
.. role:: takahashi1
.. role:: takahashi2
...
&lt;&#x2F;pre&gt;
     &lt;&#x2F;li&gt;
     &lt;&#x2F;ul&gt;
    &lt;&#x2F;dd&gt;
    &lt;&#x2F;dl&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;dl&gt;
&lt;dt&gt;成果对比:&lt;&#x2F;dt&gt;&lt;dd&gt;
 &lt;ul&gt;
 &lt;li&gt;手写HTML幻灯 
  &lt;ul&gt;
  &lt;li&gt;45Kb
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;zoomquiet.org&#x2F;res&#x2F;s5&#x2F;100918-MyTools&#x2F;html-s5&#x2F;index.html&quot;&gt;index.html&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ul&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;手写rST生成S5幻灯 
  &lt;ul&gt;
  &lt;li&gt;38Kb
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;zoomquiet.org&#x2F;res&#x2F;s5&#x2F;100918-MyTools&#x2F;rst2s5&#x2F;index.rst&quot;&gt;index.rst&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ul&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc6R01YQ0JaV&quot; name=&quot;toc6R01YQ0JaV&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopT0paWElNV&#x27;&gt; 3. 时间帐单 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
&lt;code&gt;小结这次迁移的时间消耗&lt;&#x2F;code&gt;
&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;0.5h  试用 rst2s5
&lt;&#x2F;li&gt;
&lt;li&gt;0.5h  接入样式
&lt;&#x2F;li&gt;
&lt;li&gt;0.5h  重构Leo 模式
&lt;&#x2F;li&gt;
&lt;li&gt;2h    定制基于 rst2s5 的样式
&lt;&#x2F;li&gt;
&lt;li&gt;3h    逐一页面重写
&lt;&#x2F;li&gt;
&lt;li&gt;1h    修订发布
&lt;p&gt;&lt;&#x2F;p&gt;
共计 &lt;b&gt;7.5h&lt;&#x2F;b&gt;
 &lt;ul&gt;
 &lt;li&gt;嗯嗯嗯,主要是在重过过程中,反复调整了对应的 CSS 样式...
 &lt;&#x2F;li&gt;
 &lt;li&gt;好在一切可以快速复用到其它幻灯中了...
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;hr class=&quot;light&quot; &#x2F;&gt;
&lt;ul&gt;
&lt;li&gt;t2t渲染:: 2010-10-09 02:21:37
&lt;&#x2F;li&gt;
&lt;li&gt;动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;utility&#x2F;py4str&#x2F;StructuredText&#x2F;rst2s5-usage-2010-09-18-23-23.t2t --&gt;
</content>
</entry>

<entry>
<title type="html">然何买书不读?</title>
<category term="/mind" />
<id>/pyblosxom/2010/08/06/why-noread-paid-books-2010-08-06-11-01</id>
<updated>2010-08-06T03:01:00Z</updated>
<published>2010-08-06T03:01:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/mind/why-noread-paid-books-2010-08-06-11-01.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopNDZDTE5aR&#x27; id=&#x27;toptopNDZDTE5aR&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;然何买书不读?&lt;&#x2F;h1&gt;
&lt;h2&gt;~~自我心理分析&lt;&#x2F;h2&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
  &lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#toc1R0VYQ0IyT&quot;&gt;问&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc2R0lYQ0JaN&quot;&gt;答&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc3R01YQ0IyR&quot;&gt;解&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ol&gt;

&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;a id=&quot;toc1R0VYQ0IyT&quot; name=&quot;toc1R0VYQ0IyT&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopNDZDTE5aR&#x27;&gt; 1. 问 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;发觉近来自个儿买的书被读的越来越少
&lt;&#x2F;li&gt;
&lt;li&gt;好容易得空也是积极看网络中可以免费获得的
&lt;p&gt;&lt;&#x2F;p&gt;
何也?
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc2R0lYQ0JaN&quot; name=&quot;toc2R0lYQ0JaN&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopNDZDTE5aR&#x27;&gt; 2. 答 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;买了就是自个儿的了,什么时候读就不重要了
&lt;&#x2F;li&gt;
&lt;li&gt;网络中免费得的也都是有网络费用的,但是相对低很多,很占便宜的!在没有和谐前,多看哪...
&lt;p&gt;&lt;&#x2F;p&gt;
然也?
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc3R01YQ0IyR&quot; name=&quot;toc3R01YQ0IyR&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopNDZDTE5aR&#x27;&gt; 3. 解 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;as &lt;a href=&quot;http:&#x2F;&#x2F;book.douban.com&#x2F;subject&#x2F;4275054&#x2F;&quot;&gt;网民的狂欢：关于互联网弊端的反思 (豆瓣)&lt;&#x2F;a&gt; 网络中流传的多不靠谱
&lt;&#x2F;li&gt;
&lt;li&gt;图书里倒是严密的比较多(得有过滤无良书商和译者的能力)
&lt;&#x2F;li&gt;
&lt;li&gt;只有读进心里的才是自个儿的,否则只是一堆纸而已!
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;p&gt;
时间的投入产出,是自个儿的控制和选择...
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;但是,读书的体验和氛围是有技巧营造的,就看自个儿是否愿意了...
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;hr class=&quot;light&quot; &#x2F;&gt;
&lt;ul&gt;
&lt;li&gt;t2t渲染:: 2010-10-09 02:21:39
&lt;&#x2F;li&gt;
&lt;li&gt;动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;mind&#x2F;why-noread-paid-books-2010-08-06-11-01.t2t --&gt;
</content>
</entry>

<entry>
<title type="html">MoinMoin插件hacking</title>
<category term="/utility/py4web/MoinMoin" />
<id>/pyblosxom/2010/07/30/moin-graphviz-hack-2010-07-30-15-00</id>
<updated>2010-07-30T07:00:00Z</updated>
<published>2010-07-30T07:00:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/utility/py4web/MoinMoin/moin-graphviz-hack-2010-07-30-15-00.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopSlZYV1MzU&#x27; id=&#x27;toptopSlZYV1MzU&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;MoinMoin插件hacking&lt;&#x2F;h1&gt;
&lt;h2&gt;~Graphviz 图谱可点击!&lt;&#x2F;h2&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
  &lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#toc1R0VYQ0IyT&quot;&gt;需求&lt;&#x2F;a&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#toc2R0VYRENMU&quot;&gt;1.1. Hacking&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc3R0VYREVMU&quot;&gt;1.2. jQuery&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc4R0VYREdMU&quot;&gt;1.3. 编码问题&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc5R0lYQ0JaT&quot;&gt;小结&lt;&#x2F;a&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#toc6R0lYRENMU&quot;&gt;2.1. 时间清单&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ol&gt;

&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;a id=&quot;toc1R0VYQ0IyT&quot; name=&quot;toc1R0VYQ0IyT&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopSlZYV1MzU&#x27;&gt; 1. 需求 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
&lt;a href=&quot;http:&#x2F;&#x2F;moinmo.in&#x2F;GraphVizForMoin&quot;&gt;GraphVizForMoin&lt;&#x2F;a&gt; 插件部署到MoinMoin 中之后,很爽直!
&lt;&#x2F;p&gt;
&lt;p&gt;
参考: &lt;a href=&quot;http:&#x2F;&#x2F;wiki.woodpecker.org.cn&#x2F;moin&#x2F;GraphVizForMoin&quot;&gt;在维基中使用 Graphviz&lt;&#x2F;a&gt;~ 啄木鸟中的效果
&lt;&#x2F;p&gt;
&lt;p&gt;
可以说,解决了在维基中无法快速表达思维导图的问题:
&lt;&#x2F;p&gt;
 &lt;ul&gt;
 &lt;li&gt;以往都是使用 FreeMind 绘制后截屏附件上来
 &lt;&#x2F;li&gt;
 &lt;li&gt;或是使用插件 &lt;a href=&quot;http:&#x2F;&#x2F;moinmo.in&#x2F;ParserMarket&#x2F;FreeMind&quot;&gt;ParserMarket&#x2F;FreeMind - MoinMoin&lt;&#x2F;a&gt; 将文件使用Flash 控件就地发布出来~中文一直是个问题
 &lt;p&gt;&lt;&#x2F;p&gt;
但是,使用 Graphviz 的dot 图形脚本在维基中书写图谱一直以来残念的问题是无法输出可点击的有热区的导图!
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;

&lt;ul&gt;
&lt;li&gt;有点希望的 &lt;a href=&quot;http:&#x2F;&#x2F;moinmo.in&#x2F;ParserMarket&#x2F;ImageMap&#x2F;ReleaseNotes&quot;&gt;ParserMarket&#x2F;ImageMap&#x2F;ReleaseNotes - MoinMoin&lt;&#x2F;a&gt; 插件使用起来和 dot 命令输出的标准图片热区数据又实在相差太远...
&lt;p&gt;&lt;&#x2F;p&gt;
怎么整?! 自个儿来!
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc2R0VYRENMU&quot; name=&quot;toc2R0VYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSlZYV1MzU&#x27;&gt; 1.1. Hacking &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;dl&gt;
&lt;dt&gt;思路:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;ul&gt;
    &lt;li&gt;hacked MoinGraphViz 令其使用&lt;code&gt;-Tcmapx -o **.mp&lt;&#x2F;code&gt;命令,输出热区定义
    &lt;&#x2F;li&gt;
    &lt;li&gt;hacked MoinMoin 相关脚本令输出到HTML 的图片认识可能的热区定义
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;dl&gt;
&lt;dt&gt;fxied:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;code&gt;path&#x2F;2&#x2F;moin运行实例&#x2F;data&#x2F;plugin&#x2F;parser&#x2F;MoinGraphViz&#x2F;main.py&lt;&#x2F;code&gt; 是插件的主体
    &lt;&#x2F;li&gt;
    &lt;li&gt;很直白,快速就定位了具体代码进行了修订
    &lt;p&gt;&lt;&#x2F;p&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;
&lt;dt&gt;diff:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  diff&quot;&gt;

Index: tasks&#x2F;wiki.KUP&#x2F;MoinMoin&#x2F;parser&#x2F;MoinGraphViz&#x2F;main.py
===================================================================
--- tasks&#x2F;wiki.KUP&#x2F;MoinMoin&#x2F;parser&#x2F;MoinGraphViz&#x2F;main.py (revision 16946)
+++ tasks&#x2F;wiki.KUP&#x2F;MoinMoin&#x2F;parser&#x2F;MoinGraphViz&#x2F;main.py (revision 16975)
@@ -56,4 +56,5 @@
         p = request.formatter.page
         self.renderer = Renderer(tool, targetdir=p.getPagePath(&#x27;attachments&#x27;), encoding=config.charset)
+        self.attapath = p.getPagePath(&#x27;attachments&#x27;)

     def format(self, formatter):
@@ -61,5 +62,10 @@
         ##w(&#x27;&amp;lt;div style=&quot;border:3px ridge gray; padding:5px; width:95%; overflow:auto&quot;&amp;gt;&#x27;)
         s = self.renderer.render(self.raw)
+        imgname = os.path.basename(s)
+        #s = wiki2html(self.request, &#x27;{{attachment:%s}}&#x27; % os.path.basename(s))
         s = wiki2html(self.request, &#x27;{{attachment:%s}}&#x27; % os.path.basename(s))
+        #   100728 Zoom.Quiet fixed for include URL hotarea map define
+        pfImgMap = &quot;%s&#x2F;%s.map&quot;%(self.attapath,imgname)
+        s += fread(pfImgMap)
         print &#x27;[TRACE] attachment URL:&#x27;, s
         w(s)
@@ -182,5 +193,7 @@

 def renderGraphImage(tool, format, imagefilename, dotfilename):
-    cmd = &#x27;%(tool)s -T%(format)s -o&quot;%(imagefilename)s&quot; &quot;%(dotfilename)s&quot;&#x27; % locals()
+    #100728 Zoom.Quiet fixed for export URL hotarea map export
+    cmd = &#x27;%(tool)s -T%(format)s -o&quot;%(imagefilename)s&quot; -Tcmapx -o &quot;%(imagefilename)s.map&quot; &quot;%(dotfilename)s&quot;&#x27; % locals()
+    #cmd = &#x27;%(tool)s -T%(format)s -o&quot;%(imagefilename)s&quot; &quot;%(dotfilename)s&quot;&#x27; % locals()
     print &#x27;[TRACE] executing:&#x27;, cmd
     os.system(cmd

&lt;&#x2F;pre&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;dl&gt;
&lt;dt&gt;html 输出:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  html&quot;&gt;

&amp;lt;img alt=&quot;graphviz-hostLegendG-a58ce04d28b92b59230a72964c27a9f8fc867de5.png&quot; 
class=&quot;attachment&quot; 
src=&quot;&#x2F;moin&#x2F;KupHostsMapping&#x2F;MapLegend?action=AttachFile&amp;amp;amp;do=get&amp;amp;amp;target=graphviz-hostLegendG-a58ce04d28b92b59230a72964c27a9f8fc867de5.png&quot; 
title=&quot;graphviz-hostLegendG-a58ce04d28b92b59230a72964c27a9f8fc867de5.png&quot; &#x2F;&amp;gt; 
&amp;lt;map id=&quot;hostLegendG&quot; name=&quot;hostLegendG&quot;&amp;gt;
&amp;lt;area shape=&quot;rect&quot; href=&quot;http:&#x2F;&#x2F;wiki.s.kingsoft.net&#x2F;moin&#x2F;KupHosts&quot; title=&quot;普配主机&quot; alt=&quot;&quot; coords=&quot;101,36,173,63&quot;&#x2F;&amp;gt;
&amp;lt;area shape=&quot;rect&quot; href=&quot;http:&#x2F;&#x2F;wiki.s.kingsoft.net&#x2F;moin&#x2F;KupHosts&quot; title=&quot;高配主机&quot; alt=&quot;&quot; coords=&quot;197,36,269,63&quot;&#x2F;&amp;gt;
&amp;lt;&#x2F;map&amp;gt;
&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;b&gt;注意&lt;&#x2F;b&gt;: 发现,插件是直接使用&lt;code&gt;{{attachment:导图图片名}}&lt;&#x2F;code&gt; 标准的图片附件形式来发布的!
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;然而,HTML 中要想啓用热区图,至少要有专用属性的对应:
&lt;pre&gt;
&amp;lt;img usemap=&quot;#俺的ImgMap&quot; src=&quot;...&quot;&#x2F;&amp;gt;
&amp;lt;map id=&quot;俺的ImgMap&quot; name=&quot;俺的ImgMap&quot;&amp;gt;
&amp;lt;area shape=&quot;rect&quot; href=&quot;...&quot; title=&quot;普配主机&quot; alt=&quot;&quot; coords=&quot;101,36,173,63&quot;&#x2F;&amp;gt;
...
&amp;lt;&#x2F;map&amp;gt;
&lt;&#x2F;pre&gt;
 &lt;ul&gt;
 &lt;li&gt;在dot 输出的map 数据中,id&#x2F;name 就是``digraph G { `` 第一行的那个G,可以任意命名,当然最好是E文
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;所以,就得找到方法来让 MoinMoin 对附件图片追加&lt;code&gt;usemap&lt;&#x2F;code&gt;属性
&lt;p&gt;&lt;&#x2F;p&gt;
找哈找,幸好有 &lt;a href=&quot;http:&#x2F;&#x2F;manpages.ubuntu.com&#x2F;manpages&#x2F;jaunty&#x2F;man1&#x2F;ack-grep.1p.html&quot;&gt;ack-grep&lt;&#x2F;a&gt; 快速从一堆脚本中定位到靠谱的代码段:
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;pre&gt;
path&#x2F;2&#x2F;python2.5&#x2F;site-packages&#x2F;MoinMoin&#x2F;formatter&#x2F;text_html.py
...
    def attachment_image(self, url, **kw):
        ...
        if exists:
            ...
            if not &#x27;alt&#x27; in kw:
                kw[&#x27;alt&#x27;] = kw[&#x27;title&#x27;]
            #   100729 Zoom.Quiet fixed for support imagemap for Graphviz
            kw[&#x27;usemap&#x27;] = &quot;#%s&quot;%kw[&#x27;alt&#x27;]
            return self.image(**kw)
        ...
&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;p&gt;
追加一行就好...
&lt;&#x2F;p&gt;
&lt;a id=&quot;toc3R0VYREVMU&quot; name=&quot;toc3R0VYREVMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSlZYV1MzU&#x27;&gt; 1.2. jQuery &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;
虽然目标完成了,但是心里总感觉不好:
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;MoinMoin 本身的脚本被hacking 了,就等于,以后升級,迁移时,都要维护这一hacking
&lt;&#x2F;li&gt;
&lt;li&gt;很不 Pythonic 哪...
&lt;p&gt;&lt;&#x2F;p&gt;
怎么样脱离 MoinMoin 系统本身来给附件图片追加&lt;code&gt;usemap&lt;&#x2F;code&gt; 属性?
&lt;&#x2F;li&gt;
&lt;li&gt;答案,自然是的 Ajax 哪
&lt;&#x2F;li&gt;
&lt;li&gt;jQuery 就是为这类快速夹塞儿式行为诞生的哪...
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;部署jQuery:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;ul&gt;
    &lt;li&gt;这是样式的事儿,所以:
    &lt;p&gt;&lt;&#x2F;p&gt;
&lt;pre&gt;
path&#x2F;2&#x2F;moin实例&#x2F;
+-- data
    +-- plugin
        +-- theme
            +-- 你的样式定义脚本
            +-- woodpecker.py ~ 俺用的
        def footer(self, d, **keywords):
            ... # 追加
            u&#x27;&amp;lt;!-- Finally, to loading jQuery Ajax Lib. --&amp;gt;&#x27;,
            u&#x27;&amp;lt;script src=&quot;&#x2F;wiki&#x2F;common&#x2F;js&#x2F;jquery-1.4.2.min.js&quot; type=&quot;text&#x2F;javascript&quot;&amp;gt;&amp;lt;&#x2F;script&amp;gt;&#x27;,
            u&#x27;&amp;lt;script src=&quot;&#x2F;wiki&#x2F;common&#x2F;js&#x2F;jquery-graphviz-map.js&quot; type=&quot;text&#x2F;javascript&quot;&amp;gt;&amp;lt;&#x2F;script&amp;gt;&#x27;,

+-- htdoc
    +-- common
        +-- js
            +-- jquery-1.4.2.min.js ~ 官方运营用压缩版本
            +-- jquery-graphviz-map.js  ~ 动态行为定义用
&lt;&#x2F;pre&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;dl&gt;
&lt;dt&gt;使用jQuery:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;ul&gt;
    &lt;li&gt;看看文档,就两行搞定..
&lt;pre class=&quot;brush:  js&quot;&gt;

$(document).ready(function() {
	$(&quot;img[class=&#x27;attachment&#x27;]&quot;).each(function(){
	    $(this).attr(&quot;usemap&quot;,&quot;#&quot;+$(this).attr(&quot;alt&quot;));
    });
});
&lt;&#x2F;pre&gt;
     &lt;ul&gt;
     &lt;li&gt;&lt;b&gt;特别的&lt;&#x2F;b&gt;:得考虑一页多个导图时的情况,所以是要进行 &lt;code&gt;each()&lt;&#x2F;code&gt; 循环处置
     &lt;&#x2F;li&gt;
     &lt;&#x2F;ul&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;当然的,需要 &lt;code&gt;MoinGraphViz&#x2F;main.py&lt;&#x2F;code&gt;插件的配合,以便从附图的 alt 中获得正确的图片热区ID
    &lt;p&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  diff&quot;&gt;

Index: tasks&#x2F;wiki.KUP&#x2F;MoinMoin&#x2F;parser&#x2F;MoinGraphViz&#x2F;main.py
===================================================================
--- tasks&#x2F;wiki.KUP&#x2F;MoinMoin&#x2F;parser&#x2F;MoinGraphViz&#x2F;main.py (revision 17010)
+++ tasks&#x2F;wiki.KUP&#x2F;MoinMoin&#x2F;parser&#x2F;MoinGraphViz&#x2F;main.py (revision 17013)
@@ -65,5 +65,8 @@
         fImgName = os.path.basename(s)
         pfImgMap = &quot;%s&#x2F;%s.map&quot;%(self.attapath,fImgName)
-        s = wiki2html(self.request, &#x27;{{attachment:%s}}&#x27; % os.path.basename(s))
+        #s = wiki2html(self.request, &#x27;{{attachment:%s}}&#x27; % os.path.basename(s))
+        s = wiki2html(self.request, &#x27;{{attachment:%s|%s}}&#x27; % (os.path.basename(s)
+                        ,fImgName.split(&quot;-&quot;)[1])
+                    )
         #   100728 Zoom.Quiet appended &amp;lt;map&amp;gt; data
         if os.path.exists(pfImgMap):
&lt;&#x2F;pre&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc4R0VYREdMU&quot; name=&quot;toc4R0VYREdMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSlZYV1MzU&#x27;&gt; 1.3. 编码问题 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;
一切表现良好,无意间发现凡是有URL包含的 dot 图谱,被其它页面包含时就出错!
&lt;&#x2F;p&gt;
&lt;p&gt;
&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;moin-graphviz-erro-2010-07-30-121804_780x382_scrot.png&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;
&lt;&#x2F;p&gt;
&lt;dl&gt;
&lt;dt&gt;囧rz...:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;尝试各种编码,未果
&lt;&#x2F;li&gt;
&lt;li&gt;嘗試各种&amp;lt;map&amp;gt;的包装形式:
    &lt;ol&gt;
    &lt;li&gt;使用  &amp;lt;pre&amp;gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;使用  &amp;lt;textarea&amp;gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;都在  Include 时,可怜的出错了...
&lt;&#x2F;li&gt;
&lt;li&gt;实在是因为 MoinMoin 不想处理正常的 HTML 标签属性的其它编码内容
&lt;&#x2F;li&gt;
&lt;li&gt;好吧,俺就不给出无用的中文内容!
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;path&#x2F;2&#x2F;moin运行实例&#x2F;data&#x2F;plugin&#x2F;parser&#x2F;MoinGraphViz&#x2F;main.py&lt;&#x2F;code&gt; 追加一小段正则表达式替换
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;pre class=&quot;brush:  py&quot;&gt;

    def format(self, formatter):
        w = self.request.write
        #...
        #   100728 Zoom.Quiet appended &amp;lt;map&amp;gt; data
        if os.path.exists(pfImgMap):
            import re
            p=re.compile( &#x27;title=\&quot;.+?\&quot;&#x27;)
            s += p.sub(&quot;title=\&quot;\&quot;&quot;,fread(pfImgMap))
            #s += fread(pfImgMap)

&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;dl&gt;
&lt;dt&gt;HTML 输出:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  html&quot;&gt;

&amp;lt;img alt=&quot;graphviz-hostLegendG-a58ce04d28b92b59230a72964c27a9f8fc867de5.png&quot; 
class=&quot;attachment&quot; 
src=&quot;&#x2F;moin&#x2F;KupHostsMapping&#x2F;MapLegend?action=AttachFile&amp;amp;amp;do=get&amp;amp;amp;target=graphviz-hostLegendG-a58ce04d28b92b59230a72964c27a9f8fc867de5.png&quot; 
title=&quot;graphviz-hostLegendG-a58ce04d28b92b59230a72964c27a9f8fc867de5.png&quot; &#x2F;&amp;gt; 
&amp;lt;map id=&quot;hostLegendG&quot; name=&quot;hostLegendG&quot;&amp;gt;
&amp;lt;area shape=&quot;rect&quot; href=&quot;http:&#x2F;&#x2F;wiki.s.kingsoft.net&#x2F;moin&#x2F;KupHosts&quot; title=&quot;&quot; alt=&quot;&quot; coords=&quot;101,36,173,63&quot;&#x2F;&amp;gt;
&amp;lt;area shape=&quot;rect&quot; href=&quot;http:&#x2F;&#x2F;wiki.s.kingsoft.net&#x2F;moin&#x2F;KupHosts&quot; title=&quot;&quot; alt=&quot;&quot; coords=&quot;197,36,269,63&quot;&#x2F;&amp;gt;
&amp;lt;&#x2F;map&amp;gt;
&lt;&#x2F;pre&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;p&gt;
一切安定了...
&lt;&#x2F;p&gt;
&lt;a id=&quot;toc5R0lYQ0JaT&quot; name=&quot;toc5R0lYQ0JaT&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopSlZYV1MzU&#x27;&gt; 2. 小结 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;思路不乱的情况下,主要问题就是定位代码段!以及测试!
    &lt;ul&gt;
    &lt;li&gt;面对一运行中的MoinMoin 进行测试开发时
    &lt;&#x2F;li&gt;
    &lt;li&gt;使用sshfs 可以快速挂接远程服务器的任意目录,非常方便!
    &lt;&#x2F;li&gt;
    &lt;li&gt;使用沙箱页面进行修订插件的测试,可以避免正常文章页面的中间调试失常..
    &lt;&#x2F;li&gt;
    &lt;li&gt;在调试中,直接输出预想数据到 HTML 里看,比看系统日志,使用print 要方便
    &lt;&#x2F;li&gt;
    &lt;li&gt;MoinMoin 有完备的缓冲机制,要及时看到修订效果,得重启HTTPD     
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;jQuery 真的很好用,也好学!
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;下载:&lt;&#x2F;dt&gt;&lt;dd&gt;
    diff: &lt;a href=&quot;&#x2F;pybnodes&#x2F;utility&#x2F;py4web&#x2F;MoinMoin&#x2F;MoinMoin_parser_MoinGraphViz_main.py-from-r16946-to-r17013.diff&quot;&gt;MoinMoin_parser_MoinGraphViz_main.py-from-r16946-to-r17013.diff&lt;&#x2F;a&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc6R0lYRENMU&quot; name=&quot;toc6R0lYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSlZYV1MzU&#x27;&gt; 2.1. 时间清单 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;00:05 定目标
&lt;&#x2F;li&gt;
&lt;li&gt;00:15 准备环境
&lt;&#x2F;li&gt;
&lt;li&gt;01:30 探查运行环境,明确修订目标脚本
&lt;&#x2F;li&gt;
&lt;li&gt;01:45 插件修订完成
&lt;&#x2F;li&gt;
&lt;li&gt;00:15 图片应用map jQuery 嘗試
&lt;&#x2F;li&gt;
&lt;li&gt;00:35 图片插入系统修订完成
&lt;&#x2F;li&gt;
&lt;li&gt;01:00 正则表达式+jQuery 解决 Incldue() 时的编码问题
&lt;&#x2F;li&gt;
&lt;li&gt;00:45 整理代码,发布到Blog
&lt;&#x2F;li&gt;
&lt;li&gt;00:35 整理代码,反馈到MoinMoin.in
&lt;&#x2F;li&gt;
&lt;li&gt;00:40 8次中断,回到工作场景的心理浪费
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;p&gt;
&lt;b&gt;总计:&lt;&#x2F;b&gt; ~ 6小时
&lt;&#x2F;p&gt;
&lt;hr class=&quot;light&quot; &#x2F;&gt;
&lt;ul&gt;
&lt;li&gt;t2t渲染:: 2010-10-09 02:21:37
&lt;&#x2F;li&gt;
&lt;li&gt;动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;utility&#x2F;py4web&#x2F;MoinMoin&#x2F;moin-graphviz-hack-2010-07-30-15-00.t2t --&gt;
</content>
</entry>

<entry>
<title type="html">[Py4SA]智能关闭触摸板</title>
<category term="/utility/py4sys" />
<id>/pyblosxom/2010/07/14/py4sa-off-wacom-touch-2010-07-14-10-22</id>
<updated>2010-07-14T02:22:00Z</updated>
<published>2010-07-14T02:22:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/utility/py4sys/py4sa-off-wacom-touch-2010-07-14-10-22.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopTE5JSFNOQ&#x27; id=&#x27;toptopTE5JSFNOQ&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;[Py4SA]智能关闭触摸板&lt;&#x2F;h1&gt;
&lt;h2&gt;--WACOM BAMBOO事务&lt;&#x2F;h2&gt;
&lt;h3&gt;t2t渲染:: 2010-10-09 14:21:37&lt;&#x2F;h3&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
  &lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#toc1R0VYQ0IyT&quot;&gt;问题&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc2R0lYQ0JaT&quot;&gt;尝试&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc3R01YQ0FVR&quot;&gt;Py之&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ol&gt;

&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;a id=&quot;toc1R0VYQ0IyT&quot; name=&quot;toc1R0VYQ0IyT&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopTE5JSFNOQ&#x27;&gt; 1. 问题 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
嗯嗯嗯,俺一直使用 WACOM 的数字绘图板替代鼠标的 ；－）
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;去年生日，老婆升级了俺的 &lt;a href=&quot;http:&#x2F;&#x2F;www.wacom.com.cn&#x2F;products_before_detail.php?productsid=30&quot;&gt;FAVO CTE-430&lt;&#x2F;a&gt;
到 &lt;a href=&quot;http:&#x2F;&#x2F;www.wacom.com.cn&#x2F;bamboo&#x2F;case4-1.php&quot;&gt;BAMBOO CTH-461&lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;随着 Ubuntu 10.04系统，一同升级了驱动，非常好用:
    &lt;ol&gt;
    &lt;li&gt;小横板 248.2 x 176.1，和屏幕 1:1 对应，不用拖动，有空间感觉了直接就可以移动到对应区域!
    &lt;&#x2F;li&gt;
    &lt;li&gt;无线压感笔，直接点击就是左击鼠标
    &lt;&#x2F;li&gt;
    &lt;li&gt;笔有侧键，配置默认就是原先最舒服的:
     &lt;ul&gt;
     &lt;li&gt;上键是右击
     &lt;&#x2F;li&gt;
     &lt;li&gt;下键是中击
     &lt;&#x2F;li&gt;
     &lt;&#x2F;ul&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;b&gt;触摸板的手指点击就不必要了&lt;&#x2F;b&gt;
 &lt;ul&gt;
 &lt;li&gt;如何令系统不启动触摸板的 &lt;code&gt;Touch&lt;&#x2F;code&gt; 响应?
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc2R0lYQ0JaT&quot; name=&quot;toc2R0lYQ0JaT&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopTE5JSFNOQ&#x27;&gt; 2. 尝试 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;linuxwacom.sourceforge.net&#x2F;index.php&#x2F;howto&#x2F;xsetwacom&quot;&gt;Command Line Configuration Interface (xsetwacom)&lt;&#x2F;a&gt;
    &lt;ul&gt;
    &lt;li&gt;官方是有命令行级别的配置工具的
    &lt;&#x2F;li&gt;
    &lt;li&gt;但是！真TMD难以看明白哈
    &lt;&#x2F;li&gt;
    &lt;li&gt;广泛的搜索后，大致明白,xsetwacom 提供两种配置输出:
        &lt;ol&gt;
        &lt;li&gt;命令行用的执行字串
        &lt;&#x2F;li&gt;
        &lt;li&gt;配置文件中使用的配置文本
        &lt;&#x2F;li&gt;
        &lt;&#x2F;ol&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;整个使用流程是:
        &lt;ol&gt;
        &lt;li&gt;使用其它系统监察命令，确认 WACOM 设备USB接入后的设备号
        &lt;&#x2F;li&gt;
        &lt;li&gt;使用 xsetwacom 进行模拟配置，选择输出合适的配置命令
        &lt;&#x2F;li&gt;
        &lt;li&gt;然后将输出的配置内容,部署到合适的系统启动脚本或是配置文件中
        &lt;p&gt;&lt;&#x2F;p&gt;
        &lt;&#x2F;li&gt;
        &lt;&#x2F;ol&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;俺习惯使用命令行配置,这样可以直接测试是否靠谱,但是发现:
&lt;pre class=&quot;brush:  shell&quot;&gt;

~&amp;gt; xinput --list 
⎡ Virtual core pointer                    	id=2	[master pointer  (3)]
⎜   ↳ Virtual core XTEST pointer              	id=4	[slave  pointer  (2)]
⎜   ↳ Wacom Bamboo Craft Pen eraser           	id=11	[slave  pointer  (2)]
⎜   ↳ Wacom Bamboo Craft Pen                  	id=12	[slave  pointer  (2)]
⎜   ↳ Wacom Bamboo Craft Finger pad           	id=13	[slave  pointer  (2)]
⎜   ↳ Wacom Bamboo Craft Finger               	id=14	[slave  pointer  (2)]
⎜   ↳ TPPS&#x2F;2 IBM TrackPoint                   	id=16	[slave  pointer  (2)]
⎜   ↳ Macintosh mouse button emulation        	id=18	[slave  pointer  (2)]
⎣ Virtual core keyboard                   	id=3	[master keyboard (2)]
    ↳ Virtual core XTEST keyboard             	id=5	[slave  keyboard (3)]
...
&lt;&#x2F;pre&gt;
    &lt;ul&gt;
    &lt;li&gt;使用 xinput 探察出来的 &lt;b&gt;Wacom Bamboo Craft Finger&lt;&#x2F;b&gt; 触摸板设备号,每次重启系统时不一定一样!
    &lt;&#x2F;li&gt;
    &lt;li&gt;FT! 那就得编程让系统重启时,自个儿探察一下设备号,然后使用固定的配置命令关闭 BAMBOO 对应设备
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;如何在Shell 中获取另外系统命令的输出并截获对应数码组合成新的命令?:&lt;&#x2F;dt&gt;&lt;dd&gt;
    嗯嗯嗯,,,
    嗯嗯嗯,,,,直接囧掉!
    俺没有这种功力!
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc3R01YQ0FVR&quot; name=&quot;toc3R01YQ0FVR&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopTE5JSFNOQ&#x27;&gt; 3. Py之 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;直接使用模板记录要执行的命令,预留可能变动的设备号:
&lt;pre class=&quot;brush:  shell&quot;&gt;

#!&#x2F;bin&#x2F;sh
### xinput4bamboo.tpl
sleep 3 &amp;amp;&amp;amp; xsetwacom set %s Touch &quot;off&quot;

&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;配合xinput4bamboo.py 
&lt;pre class=&quot;brush:  py&quot;&gt;

import sys,os
if __name__ == &#x27;__main__&#x27;:      # this way the module can be
    &quot;&quot;&quot;usage:
    $ xinput --list | grep &quot;Wacom Bamboo Craft Finger&quot; | python .&#x2F;xinput4bamboo.py
    &quot;&quot;&quot;
    if sys.stdin:
        for l in sys.stdin.readlines():
            if &quot;pad&quot; not in l:
                bambooid= l.split()[6].split(&quot;=&quot;)[1]
                open(&quot;xinput4bamboo.sh&quot;,&quot;w&quot;).write(open(&quot;xinput4bamboo.tpl&quot;).read()%bambooid)
                os.chmod(&quot;xinput4bamboo.sh&quot;,0755)

&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;组合成启动脚本
&lt;pre class=&quot;brush:  shell&quot;&gt;

#!&#x2F;bin&#x2F;sh
VER=&quot;main-rcloc.sh v10.7.14&quot;
DATE=`date &quot;+%y%m%d&quot;`
MYRC=&quot;&#x2F;home&#x2F;zoomq&#x2F;.zoomq&#x2F;rc.local&quot;
#=========================================================== path defines
LOGF=&quot;&#x2F;var&#x2F;log&#x2F;0day&#x2F;$DATE-myrcloc.log&quot;
#=========================================================== action defines
cd $MYRC
xinput --list | grep &quot;Wacom Bamboo Craft Finger&quot; | python .&#x2F;xinput4bamboo.py  &amp;gt;&amp;gt; $LOGF 2&amp;gt;&amp;amp;1 
.&#x2F;xinput4bamboo.sh  &amp;gt;&amp;gt; $LOGF 2&amp;gt;&amp;amp;1 
&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;部属成启动应用:
 &lt;ul&gt;
 &lt;li&gt;&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;zoomq-2010-07-14-123737_530x267_scrot.png&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;
 &lt;p&gt;&lt;&#x2F;p&gt;
&lt;b&gt;齐活！&lt;&#x2F;b&gt; 没有疑惑，随手写成！ 5分钟！
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;Python在Unix和Linux系统管理中的应用(影印版):&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;a href=&quot;http:&#x2F;&#x2F;book.douban.com&#x2F;subject&#x2F;3767034&#x2F;&quot;&gt;&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;s3876423-py4unix-linux-sa.jpg&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;绝对好书! 值得慢慢看,E文非常简洁,Py清明的代码,直接看&#x2F;尝试就可以体会到本意了...
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;hr class=&quot;light&quot; &#x2F;&gt;
&lt;p&gt;
动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;utility&#x2F;py4sys&#x2F;py4sa-off-wacom-touch-2010-07-14-10-22.t2t --&gt;
</content>
</entry>

<entry>
<title type="html">[Py4SA]批量文件重命名</title>
<category term="/utility/py4sys" />
<id>/pyblosxom/2010/07/13/py4sa-rename-mp3s-2010-07-13-22-02</id>
<updated>2010-07-13T14:02:00Z</updated>
<published>2010-07-13T14:02:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/utility/py4sys/py4sa-rename-mp3s-2010-07-13-22-02.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopTE5JSFNOQ&#x27; id=&#x27;toptopTE5JSFNOQ&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;[Py4SA]批量文件重命名&lt;&#x2F;h1&gt;
&lt;h2&gt;--远离Shell 的试探&lt;&#x2F;h2&gt;
&lt;h3&gt;t2t渲染:: 2010-10-09 14:21:37&lt;&#x2F;h3&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
  &lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#toc1R0VYQ0IyT&quot;&gt;问题&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc2R0lYQ0JaT&quot;&gt;尝试&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc3R01YQ0FVR&quot;&gt;Py之&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ol&gt;

&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;a id=&quot;toc1R0VYQ0IyT&quot; name=&quot;toc1R0VYQ0IyT&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopTE5JSFNOQ&#x27;&gt; 1. 问题 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
嗯嗯嗯,最近从 六哥的 DUKU 重新激发了评书的记忆,下载了全本 袁阔成(40回)红岩魂的mp3 ;-)
&lt;&#x2F;p&gt;
&lt;p&gt;
可是解开都是乱码文件名:
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;:&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;zoomq-2010-07-14-105626_446x300_scrot.png&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;;
&lt;&#x2F;li&gt;
&lt;li&gt;可恶的中文编码! 一定是在XP 中使用CP936 压出来的
&lt;&#x2F;li&gt;
&lt;li&gt;怎么整呢?
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;Python在Unix和Linux系统管理中的应用(影印版):&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;a href=&quot;http:&#x2F;&#x2F;book.douban.com&#x2F;subject&#x2F;3767034&#x2F;&quot;&gt;&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;s3876423-py4unix-linux-sa.jpg&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;绝对好书! 值得慢慢看,E文的也非常简洁,Py 清明的代码,直接看,尝试就可以体会到本意了...
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc2R0lYQ0JaT&quot; name=&quot;toc2R0lYQ0JaT&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopTE5JSFNOQ&#x27;&gt; 2. 尝试 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
&lt;code&gt;已知有很多途径...&lt;&#x2F;code&gt;参考:&lt;a href=&quot;http:&#x2F;&#x2F;hi.baidu.com&#x2F;sdusoul&#x2F;blog&#x2F;item&#x2F;16f81a9508a1d640d0135ede.html&quot;&gt;linux下批量修改文件名_乌哥的家常菜_百度空间&lt;&#x2F;a&gt;
&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;使用find、awk&#x2F;grep&#x2F;sed、mv等命令组合来实现
    &lt;ul&gt;
    &lt;li&gt;俺都不熟练,而且要串很多步操作，忒不直爽了..
    &lt;p&gt;&lt;&#x2F;p&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;编写Shell脚本运行~ 不就是命令组合嘛,,.,
&lt;&#x2F;li&gt;
&lt;li&gt;rename ... NGU&#x2F;Linux 中的标准化重命名工具,但是,怎么可以将批量文件中指定前几个字符替换成指定字符?
&lt;pre class=&quot;brush:  shell&quot;&gt;

~&#x2F;media&#x2F;4talking&#x2F;袁阔诚&#x2F;try&amp;gt; rename -n &#x27;s&#x2F;^.{6}&#x2F;红岩魂&#x2F;&#x27; *.mp3
...
���һ�38.mp3 renamed as 红岩魂38.mp3
���һ�39.mp3 renamed as 红岩魂39.mp3
���һ�40.mp3 renamed as 红岩魂40.mp3
&lt;&#x2F;pre&gt;
    &lt;ul&gt;
    &lt;li&gt;反复尝试半小时才获得满意的...
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;a id=&quot;toc3R01YQ0FVR&quot; name=&quot;toc3R01YQ0FVR&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopTE5JSFNOQ&#x27;&gt; 3. Py之 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
想嘗試Py 的思路...
&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  py&quot;&gt;

import sys,shutil
if __name__ == &#x27;__main__&#x27;:      # this way the module can be
    &#x27;&#x27;&#x27;usage:
        $ ls *.mp3 | python rename-zh.py
    &#x27;&#x27;&#x27;
    if sys.stdin:
        for l in sys.stdin.readlines():
            shutil.copyfile(l[:-1], &quot;redStoneSoul-%s&quot;%l[6:-1])
&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;好的,没有尝试,随手写来,3分钟搞掂
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;Python在Unix和Linux系统管理中的应用(影印版):&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;a href=&quot;http:&#x2F;&#x2F;book.douban.com&#x2F;subject&#x2F;3767034&#x2F;&quot;&gt;&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;s3876423-py4unix-linux-sa.jpg&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;绝对好书! 值得慢慢看,E文非常简洁,Py清明的代码,直接看&#x2F;尝试就可以体会到本意了...
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;hr class=&quot;light&quot; &#x2F;&gt;
&lt;p&gt;
动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;utility&#x2F;py4sys&#x2F;py4sa-rename-mp3s-2010-07-13-22-02.t2t --&gt;
</content>
</entry>

<entry>
<title type="html">hardcodedates.py</title>
<category term="/techic/PyBlosxom/plugins" />
<id>/pyblosxom/2010/05/31/hardcodedates</id>
<updated>2010-05-31T03:10:00Z</updated>
<published>2010-05-31T03:10:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/techic/PyBlosxom/plugins/hardcodedates.html" />
<content type="html">&lt;pre class=&quot;brush: python&quot;&gt;# -*- coding: utf-8 -*-
from Pyblosxom import tools
import os, os.path, posix, re, stat, time

FILETIME = re.compile(&#x27;^([0-9]{4})-([0-1][0-9])-([0-3][0-9])-([0-2][0-9])-([0-5][0-9]) +(.*)$&#x27;)

all_timestamps = {}
extensions = []
timestamps_to_save = {}


#mode: python; indent-tabs-mode: t, tab-width: 4 
&quot;&quot;&quot;
This allows the user to create a file &quot;timestamps&quot; in their datadir,
that will override the timestamp of any given blog entry. Each line
in this file should be of the form &quot;YYYY-MM-DD-hh-mm file-name&quot;.
Then for any entry that one of these lines exist the system will use
that timestamp instead of the actual files modification time.

Note: the filename is relative to your data-dir.
Example of a line for the file &#x2F;var&#x2F;data-dir&#x2F;school&#x2F;abc.txt
   where the datadir is &quot;&#x2F;var&#x2F;data-dir&#x2F;&quot; and the date is Aug 9, 2004.

2004-08-09-00-00 school&#x2F;abc.txt
&quot;&quot;&quot;
__author__ = &#x27;Nathan Kent Bullock, Ryan Barrett&#x27;
__homepage__ = &#x27;http:&#x2F;&#x2F;snarfed.org&#x2F;space&#x2F;hardcodedates&#x27;
__email__ = &#x27;nathan_kent_bullock -at- yahoo.ca, hardcodedates -at- ryanb.org&#x27;
__version__ = &#x27;1.4&#x27;
def init(request):
    if all_timestamps:
        return  # already initialized

    datadir = request.getConfiguration()[&#x27;datadir&#x27;]
    timestamp_file = os.path.join(datadir, &#x27;timestamps&#x27;)

    if os.path.isfile(timestamp_file):
        f = file(timestamp_file)
        for str in f.readlines():
            m = FILETIME.search(str.strip())
            if m:
                year = int(m.group(1))
                mo = int(m.group(2))
                day = int(m.group(3))
                hr = int(m.group(4))
                minute = int(m.group(5))
                mtime = time.mktime((year,mo,day,hr,minute,0,0,0,-1))
                filename = os.path.join(datadir, m.group(6))
                all_timestamps[filename] = mtime

        f.close()

    extensions.extend(request.getData()[&#x27;extensions&#x27;].keys())
    extensions.append(request.getConfiguration().get(&#x27;comment_ext&#x27;, &#x27;cmt&#x27;))

def cb_filestat(args):
    request = args[&#x27;request&#x27;]
    init(request)

    filename = args[&#x27;filename&#x27;]
    extension = os.path.splitext(filename)[1][1:]
    datadir = request.getConfiguration()[&#x27;datadir&#x27;]

    if all_timestamps.has_key(filename):
        # we know this file&#x27;s timestamp
        mtime = args[&#x27;mtime&#x27;]
        assert isinstance(mtime, (tuple, posix.stat_result))
        args[&#x27;mtime&#x27;] = (mtime[0:stat.ST_MTIME] + (all_timestamps[filename],) +
                         mtime[stat.ST_MTIME + 1:])

    elif extension in extensions and filename.startswith(datadir):
        # we don&#x27;t know it, but we should. ask the os for it, and remember it.
        args[&#x27;mtime&#x27;] = os.stat(filename)
        all_timestamps[filename] = args[&#x27;mtime&#x27;][stat.ST_MTIME]
        timestamps_to_save[filename] = args[&#x27;mtime&#x27;][stat.ST_MTIME]

    return args

def cb_end(args):
    if timestamps_to_save:
        datadir = args[&#x27;request&#x27;].getConfiguration()[&#x27;datadir&#x27;]
        datadir = os.path.normpath(datadir)
        tsfile = file(os.path.join(datadir, &#x27;timestamps&#x27;), &#x27;a&#x27;)
        for filename, mtime in timestamps_to_save.items():
            time_str = time.strftime(&#x27;%Y-%m-%d-%H-%M&#x27;, time.localtime(mtime))
            # strip the datadir prefix and directory separator slash
            filename = filename[len(datadir) + 1:]
            tsfile.write(&#x27;%s %s\n&#x27; % (time_str, filename))
            tools.getLogger().info(&#x27;Saved mtime %s for %s&#x27; % (time_str, filename))
        tsfile.close()
        timestamps_to_save.clear()

&lt;&#x2F;pre&gt;</content>
</entry>

<entry>
<title type="html">category_static.py</title>
<category term="/techic/PyBlosxom/plugins" />
<id>/pyblosxom/2010/05/31/category_static</id>
<updated>2010-05-31T03:10:00Z</updated>
<published>2010-05-31T03:10:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/techic/PyBlosxom/plugins/category_static.html" />
<content type="html">&lt;pre class=&quot;brush: python&quot;&gt;# -*- coding: utf-8 -*-
&quot;&quot;&quot;
category_static.py
    - just fixed for pyblosxom-cmd  staticrender export all .html links
base index.py from:
http:&#x2F;&#x2F;snarfed.org&#x2F;space&#x2F;pyblosxom+index
Ryan Barrett &lt;pyblosxom@ryanb.org&gt;
    - Zoom.Quiet 100401

This plugin displays an alphabetical index of all entries. It uses these
optional config variables from config.py, shown here with their defaults:

py[&#x27;cindex_trigger&#x27;]            = &#x27;&#x2F;site-index&#x27;
py[&#x27;cindex_num_columns&#x27;]        = 2
py[&#x27;cindex_letters_first&#x27;]      = True
py[&#x27;cindex_title&#x27;]              = &#x27;index&#x27;
py[&#x27;cindex_use_story_template&#x27;] = True


VERSION:
0.2

TODO:
- use a template instead of hard-coded HTML

Copyright 2006 Ryan Barrett

This program is free software; you can redistribute it and&#x2F;or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
&quot;&quot;&quot;


import math
import os.path
import time
from operator import itemgetter
from Pyblosxom import tools
import Pyblosxom.entries
#import re

__author__ = &#x27;Zoom.Quiet &lt;zoomquiet+pyb at gmail dot com&gt;&#x27;
__version__ = &#x27;11.09.7&#x27;
__url__ = &quot;http:&#x2F;&#x2F;blog.zoomquiet.org&#x2F;pyblosxom&#x2F;techic&#x2F;PyBlosxom&#x2F;plugins&#x2F;category_static.html&quot;
__description__ = &#x27;Displays an Category index as Tree for all entries. in one page&#x27;
DEFAULT_ROOT = []
def verify_installation(request):
  return 1

def cb_filelist(args):
    request = args[&#x27;request&#x27;]
    http = request.getHttp()
    data = request.getData()
    config = request.getConfiguration()
    _baseurl = config.get(&quot;base_url&quot;, &quot;&quot;)

    trigger = config.get(&#x27;cindex_trigger&#x27;, &#x27;site-index&#x27;)
    if http[&#x27;PATH_INFO&#x27;] != trigger:
        return

    # get the entries
    datadir = config[&#x27;datadir&#x27;]
    files = tools.Walk(request, datadir)
    files.sort()

    body = &#x27;&lt;div id=&quot;categoriselist&quot;&gt;&#x27;
    #print files
    # sort into sections, one for each letter. the dictionary is 
    # letter =&gt; (entry name, path) where path is the relative to datadir.
    #sections = {}
    #   the entrise dictionary is 
    # path =&gt; (entry name, 0) 
    entrise = []

    entry_extensions = data[&#x27;extensions&#x27;].keys()

    for file in files:
        #objEntry = entries.fileentry.FileEntry(request, file,datadir)
        #print objEntry.keys()  
        assert file.startswith(datadir)
        path, ext = os.path.splitext(file[len(datadir):])
        if ext[1:] in entry_extensions:  # strip the leading period from ext
            entry_name = os.path.basename(path)
            #sections.setdefault(entry_name[0].upper(), []).append((entry_name, path))
            entrise.append((entry_name,path,file))
    #print entrise
    #sortPaths = sorted(entrise.iteritems(), key=itemgetter(1), reverse=True)
    #print sortPaths
    #print _baseurl
    etree = {}
    &quot;&quot;&quot;{
    &quot;pathID&quot;:[(path.split()),&quot;title&quot;,...]
    ,
    }
    &quot;&quot;&quot;
    for entry in entrise:
        e = Pyblosxom.entries.fileentry.FileEntry(request, entry[2], entry[1])
        deeps = entry[1].split(&quot;&#x2F;&quot;)[:-1]
        pathID = &quot;&quot;.join(deeps)
        if pathID in etree:
            etree[pathID].append((e[&#x27;title&#x27;],entry[1]))
        else:
            etree[pathID]= [tuple(deeps),(e[&#x27;title&#x27;],entry[1])]
    #print etree.keys()
    root_path_list = config.get(&quot;category_root_list&quot;, DEFAULT_ROOT)
    root_entry_list = []
    for opath in root_path_list:
        #print opath
        crtRoot = []
        for k in etree.keys():
            if opath in k:
                crtRoot.append(k)
        crtRoot.sort()
        root_entry_list.append((opath,crtRoot))

    &#x27;&#x27;&#x27;root_entry_list as::
    [(&#x27;Zen&#x27;, [&#x27;ZenChinese&#x27;, &#x27;ZenGoogle&#x27;, &#x27;Zenpythonic&#x27;]), (&#x27;oss&#x27;, [&#x27;oss&#x27;, &#x27;ossFreeBSD&#x27;, &#x27;ossMozillaFireFox&#x27;, &#x27;ossUbuntu&#x27;]), (&#x27;opening&#x27;, []), (&#x27;mind&#x27;, [&#x27;mind&#x27;]), (&#x27;Quiet&#x27;, [&#x27;Quietliving&#x27;, &#x27;Quietnomeans&#x27;]), (&#x27;utility&#x27;, [&#x27;utilitySubversion&#x27;, &#x27;utilitySubversionhooks&#x27;, &#x27;utilitypy4strStructuredText&#x27;, &#x27;utilitypy4webDjango&#x27;, &#x27;utilitypy4webMoinMoin&#x27;, &#x27;utilitypy4webQuixote&#x27;, &#x27;utilitypy4zh&#x27;, &#x27;utilityzqlib&#x27;]), (&#x27;internet&#x27;, [&#x27;internet&#x27;, &#x27;internetFolksonomy&#x27;]), (&#x27;easy&#x27;, [&#x27;easymovie&#x27;, &#x27;easymusic&#x27;]), (&#x27;techic&#x27;, [&#x27;techic&#x27;, &#x27;techicEmacs&#x27;, &#x27;techicPyBlosxom&#x27;, &#x27;techicPyBlosxomblosxom&#x27;, &#x27;techicPyBlosxomplugins&#x27;])]
    &#x27;&#x27;&#x27;
    body += &#x27;&lt;h3&gt;&#x2F;&lt;&#x2F;h3&gt;&#x27;
    for e in etree[&#x27;&#x27;][1:]:
        #print &quot;etree[&#x27;&#x27;] include::&quot;,e
        body += &#x27;&lt;span class=&quot;indents&quot;&gt;%s&lt;&#x2F;span&gt;&lt;a href=&quot;%s%s.html&quot;&gt;%s&lt;&#x2F;a&gt;&lt;br&gt;\n&#x27;%(
            &quot;....&quot;
            ,_baseurl
            ,e[1]
            ,e[0]
            )
    #print root_entry_list

    for k in root_entry_list:
        #[&#x27;techic&#x27;, &#x27;techicEmacs&#x27;, &#x27;techicPyBlosxom&#x27;, &#x27;techicPyBlosxomblosxom&#x27;, &#x27;techicPyBlosxomplugins&#x27;]
        body += &#x27;&lt;h4&gt;%s&#x2F;&lt;&#x2F;h4&gt;&#x27;%k[0]
        cpath = &quot;&quot;
        for p in k[1]:
            #print etree[p]
            #[(&#x27;&#x27;, &#x27;Zen&#x27;, &#x27;Chinese&#x27;), &#x27;9.18&#x27;, &#x27;CC Salon BJ&#x27;, &#x27;\xe2\x80\x9c\xe5\x9b\xbd\xe9\x99\x85\xe8\x87\xaa\xe7\x94\xb1\xe8\xbd\xaf\xe4\xbb\xb6\xe6\x97\xa5\xe2\x80\x9d\xe4\xb9\x8b\xe5\xa4\xb4\xe8\x84\x91\xe9\xa3\x8e\xe6\x9a\xb4&#x27;, &#x27;\xe8\xa1\xa8\xe5\xbd\xa2\xe7\xa0\x81\xe7\x9a\x84\xe6\xb6\x88\xe4\xba\xa1\xe8\x83\x8c\xe6\x99\xaf\xef\xbc\x81&#x27;]
            epath = &quot;&#x2F;&quot;.join(etree[p][0][2:])
            if k[0] != &quot;&quot;.join(etree[p][0]):
                if cpath != epath:
                    cpath = epath
                    ldeep = len(etree[p][0][1:])
                    if 3 &gt; ldeep:
                        body += &#x27;&lt;H5&gt;%s&#x2F;&lt;&#x2F;H5&gt;&#x27;%&quot;&#x2F;&quot;.join(etree[p][0][2:])
                    else:
                        body += &#x27;&lt;H6&gt;%s&#x2F;&lt;&#x2F;H6&gt;&#x27;%&quot;&#x2F;&quot;.join(etree[p][0][3:])
            for e in etree[p][1:]:
                body += &#x27;&lt;span id=&quot;%s&quot; class=&quot;indents&quot;&gt;%s&lt;&#x2F;span&gt;&lt;a href=&quot;%s%s.html&quot;&gt;%s&lt;&#x2F;a&gt;&lt;br&gt;\n&#x27;%(
                        &quot;&#x2F;&quot;.join(etree[p][0])
                        ,&quot;...&quot;*len(etree[p][0])
                        ,_baseurl
                        ,e[1]
                        ,e[0]
                        )

    &#x27;&#x27;&#x27;
    [(&#x27;&#x27;, &#x27;easy&#x27;, &#x27;movie&#x27;), &#x27;\xe4\xb8\x96\xe9\x97\xb4\xe5\xae\x89\xe5\xbe\x97\xe5\x8f\x8c\xe5\x85\xa8\xe6\xb3\x95,\xe4\xb8\x8d\xe8\xb4\x9f\xe5\xa6\x82\xe6\x9d\xa5\xe4\xb8\x8d\xe8\xb4\x9f\xe5\x8d\xbf!&#x27;]
    [(&#x27;&#x27;, &#x27;easy&#x27;, &#x27;music&#x27;), &#x27;ZARD\xe6\xb6\x88\xe9\x80\x9d\xe4\xba\x86&#x27;]

    for entry in entrise:
        e = Pyblosxom.entries.fileentry.FileEntry(request, entry[2], entry[1])
        #print e[&#x27;title&#x27;]
        #print entry[1].split(&quot;&#x2F;&quot;)[:-1]
        body += &#x27;&lt;span class=&quot;indents&quot;&gt;%s&lt;&#x2F;span&gt;&lt;a href=&quot;%s%s.html&quot;&gt;%s&lt;&#x2F;a&gt;%s&lt;br&gt;\n&#x27;%(
                &quot;....&quot;*len(entry[1].split(&quot;&#x2F;&quot;))
                ,_baseurl
                ,entry[1]
                ,e[&#x27;title&#x27;] #entry[0]
                ,entry[1]
                )
    &#x27;&#x27;&#x27;
    #print body
    body +=&quot;&lt;&#x2F;div&gt;&quot; 
    data = {&#x27;title&#x27;: config.get(&#x27;cindex_title&#x27;, &#x27;index&#x27;)}
    # use the epoch for mtime. otherwise, pyblosxom uses the current time, which
    # makes other plugins (like weblogsping) think this is a new entry.
    epoch = time.localtime(0)
    fe = Pyblosxom.entries.base.generate_entry(request, data, body, epoch)
    return [fe]

def cb_story(args):
  request = args[&#x27;request&#x27;]
  http = request.getHttp()
  config = request.getConfiguration()
  trigger = config.get(&#x27;cindex_trigger&#x27;, &#x27;site-index&#x27;)

  if (http[&#x27;PATH_INFO&#x27;] == trigger and
      not config.get(&#x27;cindex_use_story_template&#x27;, 1)):
    title = config.get(&#x27;cindex_title&#x27;, &#x27;index&#x27;)
    args[&#x27;template&#x27;] = &#x27;&lt;h1 class=&quot;index&quot;&gt;%s&lt;&#x2F;h1&gt;\n&lt;hr &#x2F;&gt;\n$body&#x27; % title

  return args
&lt;&#x2F;pre&gt;</content>
</entry>

<entry>
<title type="html">index_static.py</title>
<category term="/techic/PyBlosxom/plugins" />
<id>/pyblosxom/2010/05/31/index_static</id>
<updated>2010-05-31T03:10:00Z</updated>
<published>2010-05-31T03:10:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/techic/PyBlosxom/plugins/index_static.html" />
<content type="html">&lt;pre class=&quot;brush: python&quot;&gt;# -*- coding: utf-8 -*-
&quot;&quot;&quot;
index_static.py
    - just fixed for pyblosxom-cmd  staticrender export all .html links
base index.py from:
http:&#x2F;&#x2F;snarfed.org&#x2F;space&#x2F;pyblosxom+index
Ryan Barrett &lt;pyblosxom@ryanb.org&gt;

This plugin displays an alphabetical index of all entries. It uses these
optional config variables from config.py, shown here with their defaults:

py[&#x27;index_trigger&#x27;]            = &#x27;&#x2F;site-index&#x27;
py[&#x27;index_num_columns&#x27;]        = 2
py[&#x27;index_letters_first&#x27;]      = True
py[&#x27;index_title&#x27;]              = &#x27;index&#x27;
py[&#x27;index_use_story_template&#x27;] = True


VERSION:
0.2

TODO:
- use a template instead of hard-coded HTML

Copyright 2006 Ryan Barrett

This program is free software; you can redistribute it and&#x2F;or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
&quot;&quot;&quot;
import math
import os.path
import time
from Pyblosxom import tools
import Pyblosxom.entries

__author__ = &#x27;Ryan Barrett&#x27;
__version__ = &#x27;0.2&#x27;
__url__ = &#x27;http:&#x2F;&#x2F;snarfed.org&#x2F;space&#x2F;pyblosxom+index&#x27;
__description__ = &#x27;Displays an alphabetical index of all entries.&#x27;


def verify_installation(request):
  return 1

def cb_filelist(args):
  request = args[&#x27;request&#x27;]
  http = request.getHttp()
  data = request.getData()
  config = request.getConfiguration()

  trigger = config.get(&#x27;index_trigger&#x27;, &#x27;site-index&#x27;)
  if http[&#x27;PATH_INFO&#x27;] != trigger:
    return

  # get the entries
  datadir = config[&#x27;datadir&#x27;]
  files = tools.Walk(request, datadir)
  files.sort()

  # sort into sections, one for each letter. the dictionary is 
  # letter =&gt; (entry name, path) where path is the relative to datadir.
  sections = {}
  entry_extensions = data[&#x27;extensions&#x27;].keys()

  for file in files:
    assert file.startswith(datadir)
    path, ext = os.path.splitext(file[len(datadir):])
    if ext[1:] in entry_extensions:  # strip the leading period from ext
      entry_name = os.path.basename(path)
      sections.setdefault(entry_name[0].upper(), []).append((entry_name, path))

  # extract the first letters. sort as usual, except that numbers and other
  # non-letters go *after* letters. 
  def letters_before_symbols(a, b):
    if a.isalpha() and not b.isalpha():
      return -1
    elif not a.isalpha() and b.isalpha():
      return 1
    else:
      return cmp(a, b)

  letters = sections.keys()
  if config.get(&#x27;index_letters_first&#x27;, 1):
    letters.sort(letters_before_symbols)
  else:
    letters.sort()

  # add the header with links to each section
  body = &#x27;&lt;p class=&quot;index-header&quot;&gt;&#x27;
  letter_links = [&#x27;&lt;a href=&quot;#%s&quot;&gt;%s&lt;&#x2F;a&gt;&#x27; % (l, l) for l in letters]
  body += &#x27; |\n&#x27;.join(letter_links)
  body += &#x27;&lt;&#x2F;p&gt;\n&lt;hr class=&quot;index&quot;&#x2F;&gt;\n\n&#x27;

  # add the sections themselves, with one link per entry, in a table. the
  # number of columns is taken from the index_num_columns config variable.
  # entries are ordered down each column, in order.
  num_cols = config.get(&#x27;index_num_columns&#x27;, 2)

  for l in letters:
    body += &#x27;&lt;h3 class=&quot;index&quot;&gt;%s&lt;&#x2F;h3&gt; &lt;a name=&quot;%s&quot;&gt;&lt;&#x2F;a n&gt;\n&#x27; % (l, l)
    body += &#x27;&lt;table class=&quot;index&quot;&gt;\n&#x27;

    entries = sections[l]
    entries.sort()
    num_rows = int(math.ceil(float(len(entries)) &#x2F; num_cols))

    for row in range(0, num_rows):
      # alternate the &lt;tr&gt; tags&#x27; class between index-row-stripe-0 and
      # index-row-stripe-1, so you can use CSS to alternate their color for
      # readability, if you want.
      body += &#x27;&lt;tr class=&quot;index-row-stripe-%d&quot;&gt;\n&#x27; % (row % 2)
      for col in range(0, num_cols):
        entry_index = col * num_rows + row
        if entry_index &lt; len(entries):
          entry_name, path = entries[entry_index]
        else:
          entry_name = path = &#x27;&#x27;
        body += &#x27;&lt;td&gt;&lt;a href=&quot;%s.html&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;td&gt;\n&#x27; % (path[1:], entry_name)
      body += &#x27;&lt;&#x2F;tr&gt;\n&#x27;

    body += &#x27;&lt;&#x2F;table&gt;\n&lt;hr class=&quot;index&quot;&#x2F;&gt;\n\n&#x27;

  data = {&#x27;title&#x27;: config.get(&#x27;index_title&#x27;, &#x27;index&#x27;)}
  # use the epoch for mtime. otherwise, pyblosxom uses the current time, which
  # makes other plugins (like weblogsping) think this is a new entry.
  epoch = time.localtime(0)
  fe = Pyblosxom.entries.base.generate_entry(request, data, body, epoch)
  return [fe]

def cb_story(args):
  request = args[&#x27;request&#x27;]
  http = request.getHttp()
  config = request.getConfiguration()
  trigger = config.get(&#x27;index_trigger&#x27;, &#x27;site-index&#x27;)

  if (http[&#x27;PATH_INFO&#x27;] == trigger and
      not config.get(&#x27;index_use_story_template&#x27;, 1)):
    title = config.get(&#x27;index_title&#x27;, &#x27;index&#x27;)
    args[&#x27;template&#x27;] = &#x27;&lt;h1 class=&quot;index&quot;&gt;%s&lt;&#x2F;h1&gt;\n&lt;hr &#x2F;&gt;\n$body&#x27; % title

  return args
&lt;&#x2F;pre&gt;</content>
</entry>

<entry>
<title type="html">IOP:实践之一</title>
<category term="/Zen/IOP" />
<id>/pyblosxom/2010/05/13/iop-how2-tenfold-speed-py-script-2010-05-13-19-19</id>
<updated>2010-05-13T11:19:00Z</updated>
<published>2010-05-13T11:19:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/Zen/IOP/iop-how2-tenfold-speed-py-script-2010-05-13-19-19.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopSkZIVkFPW&#x27; id=&#x27;toptopSkZIVkFPW&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;IOP:实践之一&lt;&#x2F;h1&gt;
&lt;h2&gt;~ 如何令Python脚本提速100倍?!&lt;&#x2F;h2&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
  &lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#toc1R0VYQ0IyR&quot;&gt;背景&lt;&#x2F;a&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#toc2R0VYRENMU&quot;&gt;1.1. 预案&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc3R0lYQ0FTS&quot;&gt;IOP的加速技巧&lt;&#x2F;a&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#toc4R0lYRENMU&quot;&gt;2.1. 10万:170+4秒&lt;&#x2F;a&gt;
      &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#toc5R0lYRENMU&quot;&gt;2.1.1. code&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc6R0lYRENMU&quot;&gt;2.1.2. speed&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc7R0lYRENMU&quot;&gt;2.1.3. improve&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;&#x2F;ul&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc8R0lYREVMU&quot;&gt;2.2. 10万:150+10秒&lt;&#x2F;a&gt;
      &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#toc9R0lYREVMU&quot;&gt;2.2.1. thinking&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc10R0lYREVMU&quot;&gt;2.2.2. code&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc11R0lYREVMU&quot;&gt;2.2.3. improve&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;&#x2F;ul&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc12R0lYREdMU&quot;&gt;2.3. 10万:100+200秒?!&lt;&#x2F;a&gt;
      &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#toc13R0lYREdMU&quot;&gt;2.3.1. thinking&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc14R0lYREdMU&quot;&gt;2.3.2. code&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc15R0lYREdMU&quot;&gt;2.3.3. speed&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc16R0lYREdMU&quot;&gt;2.3.4. improve&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;&#x2F;ul&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc17R0lYRElMU&quot;&gt;2.4. 1000万:1100秒+480秒&lt;&#x2F;a&gt;
      &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#toc18R0lYRElMU&quot;&gt;2.4.1. thinking&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc19R0lYRElMU&quot;&gt;2.4.2. code&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;li&gt;&lt;a href=&quot;#toc20R0lYRElMU&quot;&gt;2.4.3. improve&lt;&#x2F;a&gt;
      &lt;&#x2F;li&gt;
      &lt;&#x2F;ul&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc21R0lYREtMU&quot;&gt;2.5. 小记&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc22R01YQ0JaV&quot;&gt;提速100倍&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ol&gt;

&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;a id=&quot;toc1R0VYQ0IyR&quot; name=&quot;toc1R0VYQ0IyR&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 1. 背景 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
什么事儿呢?
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;在一高压力服务环境中,需要加速系统的响应
&lt;&#x2F;li&gt;
&lt;li&gt;现行系统对于数据查询要尝试三种数据库源:
 &lt;ol&gt;
 &lt;li&gt;memcache
 &lt;&#x2F;li&gt;
 &lt;li&gt;redis
 &lt;&#x2F;li&gt;
 &lt;li&gt;MySQL
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;期望查询加速至少 300%
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;运行环境&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;pre&gt;
客户机:
    - 俺的Laptop HP 520
    - 双核CPU 2G内存
    - Ubuntu 9.10
DB主机:
    - CentOS 5.0
    - 单核CPU 4G 内存
&lt;&#x2F;pre&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc2R0VYRENMU&quot; name=&quot;toc2R0VYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 1.1. 预案 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;
这事儿,一想,简单哪,都放内存就好的哪
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;统计了一下需要用来查询的数据不到2千万条
&lt;&#x2F;li&gt;
&lt;li&gt;折算成文件不过1G
&lt;&#x2F;li&gt;
&lt;li&gt;加载到内存中,使用 Python 字典结构的话,也最多涨一倍,也完全可以接受
&lt;&#x2F;li&gt;
&lt;li&gt;速度?!
 &lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;yongsun.me&#x2F;2007&#x2F;11&#x2F;python-rbtree%e5%92%8c%e5%86%85%e5%bb%badict%e7%9a%84%e6%80%a7%e8%83%bd%e6%af%94%e8%be%83&#x2F;&quot;&gt;python-rbtree和内建dict的性能比较&lt;&#x2F;a&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;那绝对不是问题!
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc3R0lYQ0FTS&quot; name=&quot;toc3R0lYQ0FTS&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2. IOP的加速技巧 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
&lt;code&gt;没有想到,加速,只要不断将代码住短里面写就好!&lt;&#x2F;code&gt;
&lt;&#x2F;p&gt;
&lt;p&gt;
不知道什么是 IOP?
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;wiki.woodpecker.org.cn&#x2F;moin&#x2F;PyIOP&quot;&gt;PyIOP&lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;咔咔咔,沈游侠总结的编程态度&amp;gt;...
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc4R0lYRENMU&quot; name=&quot;toc4R0lYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.1. 10万:170+4秒 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;dl&gt;
&lt;dt&gt;最直接的实现&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;从redis 读
&lt;&#x2F;li&gt;
&lt;li&gt;生成 dict 对象
&lt;&#x2F;li&gt;
&lt;li&gt;以pickle dump 出序列化文件
&lt;&#x2F;li&gt;
&lt;li&gt;用pickle load 加载成dict对象
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc5R0lYRENMU&quot; name=&quot;toc5R0lYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.1.1. code &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;dl&gt;
&lt;dt&gt;代码:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  python&quot;&gt;

#!&#x2F;usr&#x2F;bin&#x2F;python 
# -*- coding: utf-8 -*-
import struct,sys,time
import cPickle as pickle
import redis
REVERSION = &quot;r2d.py v10.5.7&quot;
def _push2dict(dictall,key,smembers):
    dictall[struct.pack(&#x27;I&#x27;,int(key[1:]))]=[s.split(&quot;|&quot;) for s in rb.smembers(k)]    
    return dictall
if __name__ == &#x27;__main__&#x27;:      # this way the module can be
    if 3 != len(sys.argv):
        print &quot;&quot;&quot; %s usage::
$ python r2d.py redistIP limitnumber [like 10000]
        &quot;&quot;&quot; % REVERSION
    else:
        hostIP = sys.argv[1]
        limitn = sys.argv[2]
        rb = redis.Redis(host=hostIP, port=6379, db=9)
        rbkeys = rb.keys().split()
        loop = int(limitn)
        s4dict={}
        for k in rbkeys:
            if 0 == loop:
                break
            else:
                loop -=1
                _push2dict(s4dict,k,rb.smembers(k))
        pickle.dump(s4dict, open(&#x27;r4d.dump&#x27;, &#x27;wb&#x27;))
&lt;&#x2F;pre&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc6R0lYRENMU&quot; name=&quot;toc6R0lYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.1.2. speed &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;代码足够简单了,单函式,20行
&lt;&#x2F;li&gt;
&lt;li&gt;速度测试::
 &lt;ul&gt;
 &lt;li&gt;10W 值对导出 &amp;gt;170秒,导入&amp;gt;4秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;100W 值对导出 &amp;gt;500秒,导入&amp;gt;25秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;1000W 值对导出 &lt;b&gt;失败! 内存提前耗光!&lt;&#x2F;b&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc7R0lYRENMU&quot; name=&quot;toc7R0lYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.1.3. improve &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;
这完全无法接受哪...
&lt;&#x2F;p&gt;
&lt;dl&gt;
&lt;dt&gt;加速尝试::&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ol&gt;
&lt;li&gt;根据 IOP 尽量不用函式,将那个一行函式清除,代码填回循环 ~ &lt;i&gt;立即获得几秒的加速&lt;&#x2F;i&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;本来用的就是cPickle 了,模块效率没有办法了
&lt;&#x2F;li&gt;
&lt;li&gt;嗯嗯嗯,可以不用 cPickle卟?
 &lt;ul&gt;
 &lt;li&gt;直接输出自然 .py 哈?!
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;pre class=&quot;brush:  python&quot;&gt;


# 使用 str() 将字典对象用文本的方式记入 .py 
vdf = open(&quot;r2d.define.py&quot;,&quot;wa&quot;)
vdf.write(&quot;s4dict=&quot;)
vdf.write(str(s4dict))
vdf.close()
# 使用时直接 import 就好

&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;改进后测试::
 &lt;ul&gt;
 &lt;li&gt;10W 值对导出 &amp;gt;160秒,导入&amp;gt;3秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;100W 值对导出 &amp;gt;400秒,导入&amp;gt;19秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;1000W 值对导出 &lt;b&gt;依然杯具&lt;&#x2F;b&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;加速不明显:
 &lt;ul&gt;
 &lt;li&gt;导出时速度变化很小
 &lt;&#x2F;li&gt;
 &lt;li&gt;载入时速度有提升
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;进一步观察到,导出时内存飞速增长:
 &lt;ul&gt;
 &lt;li&gt;100W级别,要食掉1.6G左右的内存
 &lt;&#x2F;li&gt;
 &lt;li&gt;redis 本身也很占内存,千万级别时,也要占上G (当然这和条目数量&#x2F;内容有关)
 &lt;&#x2F;li&gt;
 &lt;li&gt;这对于服务器是个不可接受的方式
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc8R0lYREVMU&quot; name=&quot;toc8R0lYREVMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.2. 10万:150+10秒 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;dl&gt;
&lt;dt&gt;改进中间数据格式:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;从redis 读
&lt;&#x2F;li&gt;
&lt;li&gt;生成 中间log文件
&lt;&#x2F;li&gt;
&lt;li&gt;导入成 字典对象
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc9R0lYREVMU&quot; name=&quot;toc9R0lYREVMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.2.1. thinking &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;
因为有这些现实:
&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;想输出不论 pickle 或是 .py 的字典对象,都得先在内存中构造出这一对象
&lt;&#x2F;li&gt;
&lt;li&gt;随着字典对象的规模增加,必然导致这一构建过程的时间加长
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;p&gt;
经沈游侠提醒,发现字典对象其实是可以线性输出的:
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;比如说,字典结构如:
&lt;pre&gt;
{key:[(v1,v2,v3),..]
,...
}
&lt;&#x2F;pre&gt;
 &lt;ul&gt;
 &lt;li&gt;&lt;code&gt;K:[list]&lt;&#x2F;code&gt; 形式的两层结构
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;那么,就可以通过中间数据文本:
&lt;pre&gt;
(&#x27;key&#x27;, [(v1, &#x27;v2&#x27;, v3)])
...
&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;进行线性加载,e.g:
&lt;pre class=&quot;brush:  python&quot;&gt;

for l in open(&quot;r2d.define.py.log&quot;,&quot;r&quot;).readlines():
    dd = eval(l)
    if dd[0] in s4d:
        s4d[dd[0]].append((dd[1],dd[2],dd[3]))
    else:
        s4d[dd[0]]=[(dd[1],dd[2],dd[3])]

&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc10R0lYREVMU&quot; name=&quot;toc10R0lYREVMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.2.2. code &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;
快速修订对应行动代码:
&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  python&quot;&gt;

#!&#x2F;usr&#x2F;bin&#x2F;python 
# -*- coding: utf-8 -*-
import struct,sys,time
import redis
REVERSION = &quot;r2d.py v10.5.8&quot;
if __name__ == &#x27;__main__&#x27;:      # this way the module can be
    if 3 != len(sys.argv):
        print &quot;&quot;&quot; %s usage::
$ python r2d.py redistIP limitnumber [like 10000] &amp;gt; mid-data.log
        &quot;&quot;&quot; % REVERSION
    else:
        hostIP = sys.argv[1]
        limitn = sys.argv[2]
        rb = redis.Redis(host=hostIP, port=6379, db=9)
        rbkeys = rb.keys().split()
        loop = int(limitn)
        for k in rbkeys:
            if 0 == loop:
                break
            else:
                loop -=1
                dictkey = struct.pack(&#x27;I&#x27;,int(k[1:]))
                sli = []
                for s in rb.smembers(k):
                    rli = s.split(&quot;|&quot;)[:3]
                    if rli:
                        rli[0] = int(rli[0])
                        rli[1] = struct.pack(&#x27;I&#x27;,int(rli[1]))
                        rli[2] = int(rli[2])
                        sli.append(tuple(rli))
                print &amp;gt;&amp;gt; d2f,`dictkey,sli`
                #注意: `obj` 等同 repr(obj)  
&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;a id=&quot;toc11R0lYREVMU&quot; name=&quot;toc11R0lYREVMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.2.3. improve &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;
代码依然简单了,无函式,30行
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;速度测试::
 &lt;ul&gt;
 &lt;li&gt;10W 值对导出 &amp;gt;150秒,导入&amp;gt;10秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;100W 值对导出 &amp;gt;500秒,导入&amp;gt;20秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;1000W 值对导出 &amp;gt;1300秒,导入&amp;gt;90秒;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;速度看起来没有什么明显的提高
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;b&gt;不过!&lt;&#x2F;b&gt;
 &lt;ol&gt;
 &lt;li&gt;千万级别的数据可以在低配置环境中跑完了!
 &lt;&#x2F;li&gt;
 &lt;li&gt;内存占用很稳定永远90M左右,不会随字典对象的增长而增长!
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;p&gt;
嗯嗯嗯,这算是可用了...
&lt;&#x2F;p&gt;
&lt;a id=&quot;toc12R0lYREdMU&quot; name=&quot;toc12R0lYREdMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.3. 10万:100+200秒?! &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;dl&gt;
&lt;dt&gt;继续改进:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;放弃 redis 直接从MySQL 读
&lt;&#x2F;li&gt;
&lt;li&gt;生成 中间日志
&lt;&#x2F;li&gt;
&lt;li&gt;导入成 dict 文件
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc13R0lYREdMU&quot; name=&quot;toc13R0lYREdMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.3.1. thinking &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;
虽然redis 是号称最快的 K&#x2F;V 数据库产品，但是，明显就是它将整个业务响应速度拖慢了..
&lt;&#x2F;p&gt;
&lt;dl&gt;
&lt;dt&gt;为什么呢？&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;服务器程序和本地程序面对的环境是不同的
&lt;&#x2F;li&gt;
&lt;li&gt;高压力服务器程序和小压力服务器程序也是不同的
&lt;&#x2F;li&gt;
&lt;li&gt;简单来说:
 &lt;ol&gt;
 &lt;li&gt;小型服务~=每秒&amp;lt;C60
 &lt;&#x2F;li&gt;
 &lt;li&gt;中型服务~=每秒&amp;lt;C600
 &lt;&#x2F;li&gt;
 &lt;li&gt;大型服务~=每秒&amp;gt;C1000
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;面对的矛盾是完全不同的:
 &lt;ol&gt;
 &lt;li&gt;小型服务-&amp;gt;语言执行效率
 &lt;&#x2F;li&gt;
 &lt;li&gt;中型服务-&amp;gt;框架执行效率
 &lt;&#x2F;li&gt;
 &lt;li&gt;大型服务-&amp;gt;I&#x2F;O 响应速度
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;所以，对于面向Web 的查询服务，不论 Redis&#x2F;MySQL 对于业务系统，都是进程间通讯!
&lt;&#x2F;li&gt;
&lt;li&gt;每次跨进程通讯，都意味着至少四次I&#x2F;O操作！
&lt;&#x2F;li&gt;
&lt;li&gt;所以，当前 Redis-&amp;gt;log-&amp;gt;内存字典的转换流程，其实包含了 MySQL-&amp;gt;Redis 的进程操作
&lt;&#x2F;li&gt;
&lt;li&gt;另外:
 &lt;ul&gt;
 &lt;li&gt;遍查 Redis 文档，居然没有 &lt;code&gt;iterkeys()&lt;&#x2F;code&gt; 类似的操作！
 &lt;&#x2F;li&gt;
 &lt;li&gt;每次不论转换多少 Redis 的值对，都得使用&lt;code&gt;keys()&lt;&#x2F;code&gt; 将键先取出来然后再逐一匹配处理
 &lt;&#x2F;li&gt;
 &lt;li&gt;怪不得使用 Redis 测试用小仓库(包含20万值对)时，脚本运行速度和使用全数据Redis(千万值对)时速度要相差5倍以上！内存也占用多几倍!
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;p&gt;
&lt;b&gt;所以!要直接从 MySQL 相关表中读取&lt;&#x2F;b&gt;
&lt;&#x2F;p&gt;
&lt;a id=&quot;toc14R0lYREdMU&quot; name=&quot;toc14R0lYREdMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.3.2. code &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;
配合一SQL 模板:
&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  sql&quot;&gt;

-- _tpl&#x2F;all_black.tpl
SELECT v1,v2,v3,v4,id FROM t_black LIMIT %(limitMAX)s;
&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;p&gt;
核心代码:
&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  python&quot;&gt;

#!&#x2F;usr&#x2F;bin&#x2F;python 
# -*- coding: utf-8 -*-
REVERSION = &quot;m2d.py v10.5.9&quot;
import struct,sys,time

if __name__ == &#x27;__main__&#x27;:      # this way the module can be
    &quot;&quot;&quot;usage:
$ python m2d.py limit [such as 100] |\
  mysql -h xx.xx.xx.xx -u User -D --password=***  |\
  python m2d.py &amp;gt; m2d.log
    &quot;&quot;&quot;
    if sys.stdin:
        if 1 &amp;lt; len(sys.argv):
            limit = sys.argv[1]
            limitMAX = int(limit)
            print &amp;gt;&amp;gt; sys.stderr, info
            print open(&quot;_tpl&#x2F;all_black.tpl&quot;,&quot;r&quot;).read()%locals()
        else:
            s4dict={}
            virusname={}
            totalN = 0
            for l in sys.stdin.readlines():
                if &quot;id&quot; in l:
                    pass
                else:
                    totalN += 1
                    lkv=l.split()
                    dictkey = struct.pack(&#x27;I&#x27;,int(lkv[0]))
                    lkv[1] = int(lkv[1])
                    lkv[2] = struct.pack(&#x27;I&#x27;,int(lkv[2]))
                    lkv[3] = int(lkv[3])
                    print &amp;gt;&amp;gt; d2f,`dictkey,tuple(lkv[1:])`
&lt;&#x2F;pre&gt;
 &lt;ul&gt;
 &lt;li&gt;用是否有额外参数来判定是否生成SQL,还是进行MySQL 的输出数据处理
 &lt;&#x2F;li&gt;
 &lt;li&gt;为了不影响标准输出,调试信息,输出到标准错误IO
 &lt;&#x2F;li&gt;
 &lt;li&gt;调试也应该根据管道串的层级,一级级运行尝试
 &lt;&#x2F;li&gt;
 &lt;li&gt;调用的shell:
&lt;pre class=&quot;brush:  shell&quot;&gt;

#!&#x2F;bin&#x2F;sh
#   m2d.sh v10.5.9
python m2d.py go |\
    mysql -h xx.xx.xx.xx -u User --password=***|\
    python mysql4dict.py $1 |\
    mysql -h xx.xx.xx.xx -u User --password=***|\
    python m2d.py &amp;gt; m2d.log
&lt;&#x2F;pre&gt;
 &lt;p&gt;&lt;&#x2F;p&gt;
&lt;b&gt;加载时代码没有怎么变&lt;&#x2F;b&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;

&lt;a id=&quot;toc15R0lYREdMU&quot; name=&quot;toc15R0lYREdMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.3.3. speed &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;速度测试::
 &lt;ul&gt;
 &lt;li&gt;0.1W 值对导出 &amp;lt;5秒,导入&amp;lt;1秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;10W 值对导出 &amp;gt;300秒,导入&amp;gt;10秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;100W 值对导出 杯具鸟
 &lt;&#x2F;li&gt;
 &lt;li&gt;1000W 值对导出 杯具鸟
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;速度怎么和查询的条目多少有关? 而且一大MySQL 就拒绝服务?
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc16R0lYREdMU&quot; name=&quot;toc16R0lYREdMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.3.4. improve &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;
嗯嗯嗯,FT! 当然了,MySQL 请求响应时间是有限制的,大数据传输肯定是有问题的,
利用 &lt;code&gt;LIMIT&lt;&#x2F;code&gt; 的切片!
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;改造前述&lt;code&gt;m2d.py v10.5.9&lt;&#x2F;code&gt; SQL生成部分的代码:
&lt;pre class=&quot;brush:  python&quot;&gt;

step = 5000.0
limitMAX = int(limit)
sqltpl = open(&quot;_tpl&#x2F;all_black.tpl&quot;,&quot;r&quot;).read()
if 1 &amp;gt;= limitMAXb&#x2F;step:
    print sqltpl%locals()
else:
    for i in range(int(limitMAX&#x2F;step)):
        limitMAX = &quot;%d,%d&quot;%(step*i,int(step))
        print sqltpl%locals()
&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;以 5000 为界限,生成类似 &lt;code&gt;LIMIT 15000,5000&lt;&#x2F;code&gt; 的限制
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;ul&gt;
&lt;li&gt;速度测试::
 &lt;ul&gt;
 &lt;li&gt;100W 值对导出 &amp;gt;290秒,导入&amp;gt;190秒;
 &lt;&#x2F;li&gt;
 &lt;li&gt;1000W 值对导出 杯具鸟
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;p&gt;
&lt;b&gt;FT!怎么回事儿?速度意外的慢!&lt;&#x2F;b&gt;
&lt;&#x2F;p&gt;
&lt;a id=&quot;toc17R0lYRElMU&quot; name=&quot;toc17R0lYRElMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.4. 1000万:1100秒+480秒 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;dl&gt;
&lt;dt&gt;冷静后改进:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;从MySQL 读使用id 进行限制切分
&lt;&#x2F;li&gt;
&lt;li&gt;生成 中间日志,但是重新设计结构
&lt;&#x2F;li&gt;
&lt;li&gt;导入成 dict 文件
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc18R0lYRElMU&quot; name=&quot;toc18R0lYRElMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.4.1. thinking &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;dl&gt;
&lt;dt&gt;MySQL 为什么这么慢?!&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;嗯嗯嗯,N久没有使用过DB,这次重温了为什么远离DB的恶体验
&lt;&#x2F;li&gt;
&lt;li&gt;MySQL 本身就不是千万级别的产品,虽然有很多招可以应对
 &lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.cnblogs.com&#x2F;fjytzh&#x2F;archive&#x2F;2010&#x2F;04&#x2F;02&#x2F;1702886.html&quot;&gt;mysql limit查询优化（数据量大的时候很优）&lt;&#x2F;a&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;grb12508.blog.163.com&#x2F;blog&#x2F;static&#x2F;273784582009102448061&#x2F;&quot;&gt;Mysql limit 优化，百万至千万级快速分页&lt;&#x2F;a&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;不过,以上招都不好使,咨询了一下同事,直接使用ID范畴来限定就好!
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc19R0lYRElMU&quot; name=&quot;toc19R0lYRElMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.4.2. code &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;
SQL 模板配合改进:
&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  sql&quot;&gt;

-- _tpl&#x2F;all_black.tpl
SELECT v1,v2,v3,v4,id FROM t_black WHERE id&amp;gt;%(LIMbwID)s AND id&amp;lt;=%(MAXbwID)s;
&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;p&gt;
SQL 生成代码:
&lt;&#x2F;p&gt;
&lt;pre class=&quot;brush:  python&quot;&gt;

step = 3000.0
offset = int(step)
# &amp;lt; &amp;lt;gen_sql_with_max&amp;gt; &amp;gt; 使用Leo 时可以定义子节点将成堆代码变成语义标记
for l in sys.stdin.readlines():
    if &quot;max(id)&quot; not in l:
        amount = l.split()
        MAXbwID = int(amount[0]
        MINbwID = int(amount[1]
        MAXbwA = MAXbID-MINbID
MAXbMAX = MAXbwID
lastID = 0
sqltpl = open(&quot;_tpl&#x2F;all_black.tpl&quot;,&quot;r&quot;).read()
for i in range(MAXbwA&#x2F;offset):
    MAXbwID,LIMbwID = (MAXbMAX-offset*i,MAXbMAX-offset*(i+1))
    print sqltpl%locals()
    lastID = LIMbID
MAXbID,LIMbID = lastID,MINbID   # 将切片限数之内的尾数个ID也查询出来
print sqltpl%locals()
&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;咔咔咔,当然的,要进行基于ID 的精确切分选择,就得先知道最大和最小的ID
&lt;&#x2F;li&gt;
&lt;li&gt;使用SQL &lt;code&gt;SELECT max(id),min(id) FROM t_black ;&lt;&#x2F;code&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;自然运用系统管道串接成处理过程:
&lt;pre class=&quot;brush:  shell&quot;&gt;

#!&#x2F;bin&#x2F;sh
#   m2d.sh v10.5.9
DATE=`date &quot;+%y%m%d-%H%M%S&quot;`
mysql -h xx.xx.xx -u User --password=*** &amp;lt; _tpl&#x2F;total_black.sql |\
    python m2d.py go |\
    mysql -h xx.xx.xx -u User --password=*** |\
    python m2d.py &amp;gt; m2d_$DATE.log
&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc20R0lYRElMU&quot; name=&quot;toc20R0lYRElMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.4.3. improve &lt;&#x2F;A&gt;&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;速度测试::
 &lt;ul&gt;
 &lt;li&gt;100W 值对导出 &amp;gt;280秒,导入&amp;gt;120秒;
  &lt;ul&gt;
  &lt;li&gt;m2d.log &amp;gt; 150M
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ul&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;1000W 值对导出 &amp;gt;1300秒,导入&amp;gt;780秒;
  &lt;ul&gt;
  &lt;li&gt;m2d.log &amp;gt; 570M
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ul&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;p&gt;
进一步的,发现业务其实可以将双层,两次查询优化成一次查询的!
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;简单的将输出字典的数据结构变成:
&lt;pre&gt;
{key:v,...
}
&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;将原先的2个值结合原先的key 变成键,就成为了全局唯一的key
&lt;&#x2F;li&gt;
&lt;li&gt;即和MySQL 每行数据完成一一对应
&lt;&#x2F;li&gt;
&lt;li&gt;速度再测试::
 &lt;ul&gt;
 &lt;li&gt;100W 值对导出 &amp;gt;250秒,导入&amp;gt;100秒;
  &lt;ul&gt;
  &lt;li&gt;m2d.log &amp;gt; 130M
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ul&gt;
 &lt;&#x2F;li&gt;
 &lt;li&gt;1000W 值对导出 &amp;gt;1100秒,导入&amp;gt;480秒;
  &lt;ul&gt;
  &lt;li&gt;m2d.log &amp;gt; 490M
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ul&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;哗! 而且加载完后,字典对象所点内存体积也同样减少了 30% !
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc21R0lYREtMU&quot; name=&quot;toc21R0lYREtMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 2.5. 小记 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;dl&gt;
&lt;dt&gt;综上:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ul&gt;
&lt;li&gt;应用 IOP 方面的主要招术:
 &lt;ol&gt;
 &lt;li&gt;表用 函式
 &lt;&#x2F;li&gt;
 &lt;li&gt;表用 模块
 &lt;&#x2F;li&gt;
 &lt;li&gt;尽量使用 OS 的标准 I&#x2F;O 进行功能串接
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;b&gt;DOP&lt;&#x2F;b&gt;~&lt;code&gt;Data Oriented Programming&lt;&#x2F;code&gt;
 &lt;ul&gt;
 &lt;li&gt;面向数据编程
 &lt;&#x2F;li&gt;
 &lt;li&gt;归根到底,程序都得操作数据解决问题
 &lt;&#x2F;li&gt;
 &lt;li&gt;服务器端,大并发压力时,最有效的节省I&#x2F;O 的方式,就是高效方式
 &lt;&#x2F;li&gt;
 &lt;li&gt;压缩输入&#x2F;出的数据量自然是最好的代码!
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc22R01YQ0JaV&quot; name=&quot;toc22R01YQ0JaV&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopSkZIVkFPW&#x27;&gt; 3. 提速100倍 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
嗯嗯嗯？！怎么说到最后好象也没有加速到100倍哪？
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;是也乎，是也乎，以上分享的是内存化字典数据的转换脚本加速过程
&lt;&#x2F;li&gt;
&lt;li&gt;但是最后要加速的是整个查询业务哈?
&lt;&#x2F;li&gt;
&lt;li&gt;因为涉及公司核心服务,代码就无法展示了
&lt;&#x2F;li&gt;
&lt;li&gt;不过,现实是:
 &lt;ol&gt;
 &lt;li&gt;使用了以上 IOP 中提及的基础技巧
 &lt;&#x2F;li&gt;
 &lt;li&gt;每查询业务的处理时间从原先的 0.* 秒,加速到 0.00*秒,至少100倍
 &lt;&#x2F;li&gt;
 &lt;li&gt;而对应的代码从 几千行,精简到几十行
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;p&gt;
所以,基本上可以这么理解:
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;将代码每&lt;b&gt;精简一倍体积&lt;&#x2F;b&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;运行速度就有望&lt;b&gt;提高10倍&lt;&#x2F;b&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
不相信? 尝试一哈噻...
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;hr class=&quot;light&quot; &#x2F;&gt;
&lt;ul&gt;
&lt;li&gt;t2t渲染:: 2010-10-09 02:21:36
&lt;&#x2F;li&gt;
&lt;li&gt;动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;Zen&#x2F;IOP&#x2F;iop-how2-tenfold-speed-py-script-2010-05-13-19-19.t2t --&gt;
</content>
</entry>

<entry>
<title type="html">回到PyBlosxom</title>
<category term="/techic/PyBlosxom" />
<id>/pyblosxom/2010/04/18/relivin-pyblosxom-2010-04-18-23-23</id>
<updated>2010-04-18T15:23:00Z</updated>
<published>2010-04-18T15:23:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/techic/PyBlosxom/relivin-pyblosxom-2010-04-18-23-23.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopNFdOWjVaT&#x27; id=&#x27;toptopNFdOWjVaT&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;回到PyBlosxom&lt;&#x2F;h1&gt;
&lt;h2&gt;~重启Blogging生活&lt;&#x2F;h2&gt;
&lt;h3&gt;t2t渲染:2010-10-09 02:21:39&lt;&#x2F;h3&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
  &lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#toc1R0VYQ0JaV&quot;&gt;怎么了？&lt;&#x2F;a&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc2R0lYQ0IyR&quot;&gt;规划&lt;&#x2F;a&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#toc3R0lYRENMU&quot;&gt;2.1. 系统&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc4R0lYREVMU&quot;&gt;2.2. 样式&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;a href=&quot;#toc5R0lYREdMU&quot;&gt;2.3. 插件&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
  &lt;&#x2F;li&gt;
  &lt;li&gt;&lt;a href=&quot;#toc6R01YQ0JaV&quot;&gt;成果&lt;&#x2F;a&gt;
    &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#toc7R01YRENMU&quot;&gt;3.1. TODO&lt;&#x2F;a&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
  &lt;&#x2F;li&gt;
  &lt;&#x2F;ol&gt;

&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;a id=&quot;toc1R0VYQ0JaV&quot; name=&quot;toc1R0VYQ0JaV&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopNFdOWjVaT&#x27;&gt; 1. 怎么了？ &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;曾经的 PyBlosxom 1.3.1 发布的 &lt;img align=&quot;right&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;preview-old-zoomquiet.org-pyb.jpg&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;从2005年开始用到2007年南下到金山,远离了服务器,发布不便就停了下来,但是总之还在存活...
&lt;&#x2F;li&gt;
&lt;li&gt;100401 啄木鸟新SA,小白同学升级 FreeBSD 时,发现 PyBlosxom 的cgi 有安全隐患,算是彻底关闭了当年定制了很多东西的hacker 级别Blog 实例;
&lt;&#x2F;li&gt;
&lt;li&gt;刚好 &lt;a href=&quot;http:&#x2F;&#x2F;pyblosxom.sourceforge.net&#x2F;releases&#x2F;pyblosxom.1.5-rc1.html&quot;&gt;PyBlosxom1.5-rc1&lt;&#x2F;a&gt; 也发布了,就趁机整体搞一下
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;p&gt;&lt;&#x2F;p&gt;
&lt;a id=&quot;toc2R0lYQ0IyR&quot; name=&quot;toc2R0lYQ0IyR&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopNFdOWjVaT&#x27;&gt; 2. 规划 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
习惯性的先计划,再作...
&lt;&#x2F;p&gt;
&lt;a id=&quot;toc3R0lYRENMU&quot; name=&quot;toc3R0lYRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopNFdOWjVaT&#x27;&gt; 2.1. 系统 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;从PyBlosxom 1.3.1 升级到 1.5-rc1
&lt;&#x2F;li&gt;
&lt;li&gt;发布方式从 cgi 升级到 静态发布 &lt;i&gt;(类似 MT 的那种)&lt;&#x2F;i&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;版本管理从 SVN 迁移到 Hg &lt;i&gt;(依然在 code.google 空间中)&lt;&#x2F;i&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc4R0lYREVMU&quot; name=&quot;toc4R0lYREVMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopNFdOWjVaT&#x27;&gt; 2.2. 样式 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;从自个儿模仿 &lt;a href=&quot;http:&#x2F;&#x2F;www.deviantart.com&#x2F;&quot;&gt;deviantART&lt;&#x2F;a&gt; 设计的暗绿色,迁移到 Wordpress 中最轻的样式:
&lt;a href=&quot;http:&#x2F;&#x2F;www.bestwpthemes.com&#x2F;doc&#x2F;&quot;&gt;doc&lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;a id=&quot;toc5R0lYREdMU&quot; name=&quot;toc5R0lYREdMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopNFdOWjVaT&#x27;&gt; 2.3. 插件 &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;
&lt;code&gt;从用途来分类&lt;&#x2F;code&gt;
&lt;&#x2F;p&gt;
&lt;dl&gt;
&lt;dt&gt;归档:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;ul&gt;
    &lt;li&gt;使用 xhtml作为最终输出
    &lt;&#x2F;li&gt;
    &lt;li&gt;按照年月归档并计数
    &lt;&#x2F;li&gt;
    &lt;li&gt;按照分类归档并计数
    &lt;&#x2F;li&gt;
    &lt;li&gt;对所有图片进行简单的图库管理
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;dd&gt;
&lt;dt&gt;导览:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;ul&gt;
    &lt;li&gt;对静态页面网站提供搜索  
    &lt;&#x2F;li&gt;
    &lt;li&gt;前后关联文章的快速链接
    &lt;&#x2F;li&gt;
    &lt;li&gt;&lt;u&gt;分页式的导航链接&lt;&#x2F;u&gt; &lt;i&gt;杯具的插件,在静态发布状态中&lt;&#x2F;i&gt;    
    &lt;&#x2F;li&gt;
    &lt;li&gt;按照文章首字母的总索引
    &lt;&#x2F;li&gt;
    &lt;li&gt;支持多种语言的语法高亮
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;dd&gt;
&lt;dt&gt;SNS:&lt;&#x2F;dt&gt;&lt;dd&gt;
    &lt;ul&gt;
    &lt;li&gt;rdf&#x2F;rss 自动生成
    &lt;&#x2F;li&gt;
    &lt;li&gt;评注?-( &lt;i&gt;(mail 先)&lt;&#x2F;i&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;TAG云?-( &lt;i&gt;(和分类有重叠)&lt;&#x2F;i&gt;
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc6R01YQ0JaV&quot; name=&quot;toc6R01YQ0JaV&quot;&gt;&lt;&#x2F;a&gt;
&lt;h1&gt;&lt;A href=&#x27;#toptopNFdOWjVaT&#x27;&gt; 3. 成果 &lt;&#x2F;A&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;
&lt;b&gt;就是当前这个重生的 ZQ&#x27;s PyBlosxom 了&lt;&#x2F;b&gt;
&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;通过对 t2t 的hack,可以直接在 t2t 文本中聲明是否使用 &lt;a href=&quot;http:&#x2F;&#x2F;alexgorbatchev.com&#x2F;wiki&#x2F;SyntaxHighlighter:Usage&quot;&gt;SyntaxHighlighter&lt;&#x2F;a&gt; ,以及使用哪种语法刷来显示
&lt;p&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;dl&gt;
&lt;dt&gt;demo&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;pre class=&quot;brush:  python&quot;&gt;

py[&quot;plugin_dirs&quot;] = [os.path.join(blogdir, &quot;plugins&quot;)
                        ,os.path.join(blogdir, &quot;plugins&#x2F;archives&quot;)
                        ,os.path.join(blogdir, &quot;plugins&#x2F;navigate&quot;)
                        ,os.path.join(blogdir, &quot;plugins&#x2F;date&quot;)                        
                        ,os.path.join(blogdir, &quot;plugins&#x2F;preformatters&quot;)
                        ,os.path.join(blogdir, &quot;plugins&#x2F;folksonomy&quot;)
                        ,os.path.join(blogdir, &quot;plugins&#x2F;willplugins&quot;)
                        ,os.path.join(blogdir, &quot;plugins&#x2F;zqpyb+&quot;)    
                        ]
&lt;&#x2F;pre&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;a id=&quot;toc7R01YRENMU&quot; name=&quot;toc7R01YRENMU&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2&gt;&lt;A href=&#x27;#toptopNFdOWjVaT&#x27;&gt; 3.1. TODO &lt;&#x2F;A&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;
&lt;code&gt;不断维护的完美之途紀...&lt;&#x2F;code&gt;
&lt;&#x2F;p&gt;
&lt;dl&gt;
&lt;dt&gt;PyBlosxom 静态化发布体系:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ol&gt;
&lt;li&gt;升級到 1.5.1b
&lt;&#x2F;li&gt;
&lt;li&gt;摸索静态化发布
 &lt;ol&gt;
 &lt;li&gt;升迁旧样式
 &lt;&#x2F;li&gt;
 &lt;li&gt;兼容插件
 &lt;&#x2F;li&gt;
 &lt;li&gt;微调样式:
    &lt;ul&gt;
    &lt;li&gt;头部的标题索引入口文字,怎么也消除不了下划綇
    &lt;&#x2F;li&gt;
    &lt;li&gt;&#x2F;&#x2F;&lt;a href=&quot;http:&#x2F;&#x2F;alexgorbatchev.com&#x2F;wiki&#x2F;SyntaxHighlighter:Usage&quot;&gt;SyntaxHighlighter&lt;&#x2F;a&gt; 的行号后有意外空白 &#x2F;&#x2F;
        &lt;ul&gt;
        &lt;li&gt;&lt;u&gt;伪问题&lt;&#x2F;u&gt; fixed!
        &lt;&#x2F;li&gt;
        &lt;&#x2F;ul&gt;
    &lt;&#x2F;li&gt;
    &lt;li&gt;归档插件的输出页面中,日期链接失常,应该清除
    &lt;&#x2F;li&gt;
    &lt;&#x2F;ul&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Hg的 hooks 部署
&lt;&#x2F;li&gt;
&lt;li&gt;dot 的自动包含图片热区定义的 t2t 处理
&lt;&#x2F;li&gt;
&lt;li&gt;Leo 中的自动化发布脚本按钮
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;hr class=&quot;light&quot; &#x2F;&gt;
&lt;p&gt;
动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;techic&#x2F;PyBlosxom&#x2F;relivin-pyblosxom-2010-04-18-23-23.t2t --&gt;
</content>
</entry>

<entry>
<title type="html">OpenBookProject</title>
<category term="/opening/OpenBookProj" />
<id>/pyblosxom/2010/01/01/open-book-project-2010-01-01-23-23</id>
<updated>2010-01-01T15:23:00Z</updated>
<published>2010-01-01T15:23:00Z</published>
<link rel="alternate" type="text/html" href="/pyblosxom/opening/OpenBookProj/open-book-project-2010-01-01-23-23.html" />
<content type="html">&lt;div class=&quot;header&quot; id=&quot;header&quot;&gt;
&lt;a name=&#x27;toptopSjVZR0szU&#x27; id=&#x27;toptopSjVZR0szU&#x27;&gt;&lt;&#x2F;a&gt;&lt;h1&gt;OpenBookProject&lt;&#x2F;h1&gt;
&lt;h2&gt;--开放图书计划&lt;&#x2F;h2&gt;
&lt;&#x2F;div&gt;

&lt;div class=&quot;toc&quot; id=&quot;toc&quot;&gt;
&lt;&#x2F;div&gt;
&lt;div class=&quot;body&quot; id=&quot;body&quot;&gt;
&lt;p&gt;
&lt;img align=&quot;middle&quot; src=&quot;&#x2F;pybimage&#x2F;2010&#x2F;OpenBookProject-h90.png&quot; border=&quot;0&quot; alt=&quot;&quot;&#x2F;&gt;
&lt;&#x2F;p&gt;
&lt;dl&gt;
&lt;dt&gt;历史小记:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;&#x2F;dd&gt;
&lt;&#x2F;dl&gt;

&lt;ol&gt;
&lt;li&gt;2005-12-10 07:34:19 &lt;a href=&quot;http:&#x2F;&#x2F;wiki.woodpecker.org.cn&#x2F;moin&#x2F;OsmondLiang&quot;&gt;梁如军，Osmond&lt;&#x2F;a&gt;创建维基入口
 &lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;wiki.woodpecker.org.cn&#x2F;moin&#x2F;OpenBookProject&quot;&gt;http:&#x2F;&#x2F;wiki.woodpecker.org.cn&#x2F;moin&#x2F;OpenBookProject&lt;&#x2F;a&gt;
 &lt;&#x2F;li&gt;
 &lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;2007-07-26 22:07:06 +0800 Zoom.Quiet 创建工程环境 &lt;a href=&quot;http:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;openbookproject&#x2F;&quot;&gt;openbookproject - Project Hosting on Google Code&lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;在OBP组织下2007-12-07 &lt;a href=&quot;http:&#x2F;&#x2F;book.douban.com&#x2F;subject&#x2F;3112503&#x2F;&quot;&gt;《Python核心编程》(中文第二版) (豆瓣)&lt;&#x2F;a&gt; 完成翻译，也引发了&lt;a href=&quot;http:&#x2F;&#x2F;www.china-pub.com&#x2F;member&#x2F;bookpinglun&#x2F;viewpinglun.asp?bookname=&amp;amp;reader=0&amp;amp;gid=0&amp;amp;id=39969&amp;amp;Curpage=9&amp;amp;sale=0&amp;amp;plgrade=1&quot;&gt;书评__China-Pub 《Python 核心编程》应属于社区翻译&lt;&#x2F;a&gt; 吉广事件！
&lt;&#x2F;li&gt;
&lt;li&gt;在OBP组织下2008-04-01  &lt;a href=&quot;http:&#x2F;&#x2F;book.douban.com&#x2F;subject&#x2F;3117898&#x2F;&quot;&gt;Python源码剖析——深度探索动态语言核心技术 (豆瓣)&lt;&#x2F;a&gt; 完成校对
&lt;&#x2F;li&gt;
&lt;li&gt;在OBP组织下2009-09-01 &lt;a href=&quot;http:&#x2F;&#x2F;book.douban.com&#x2F;subject&#x2F;3884108&#x2F;&quot;&gt;可爱的Python (豆瓣)&lt;&#x2F;a&gt; 方式发售
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;obp.zoomquiet.org&#x2F;&quot;&gt;http:&#x2F;&#x2F;obp.zoomquiet.org&#x2F;&lt;&#x2F;a&gt; 开始使用Sphinx 持续日编译发布最新 OBP 成果...
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;hr class=&quot;light&quot; &#x2F;&gt;
&lt;ul&gt;
&lt;li&gt;t2t渲染:: 2010-10-09 02:21:43
&lt;&#x2F;li&gt;
&lt;li&gt;动力源自::&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;txt2tags.sf.net&quot;&gt;txt2tags&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;&#x2F;div&gt;

&lt;!-- xhtml code generated by txt2tags 2.4 (http:&#x2F;&#x2F;txt2tags.sf.net) --&gt;
&lt;!-- cmdline: txt2tags .&#x2F;opening&#x2F;OpenBookProj&#x2F;open-book-project-2010-01-01-23-23.t2t --&gt;
</content>
</entry>
</feed>
